%!PS-Adobe-2.0
%%Creator: dvips(k) 5.92b Copyright 2002 Radical Eye Software
%%Title: papi.dvi
%%Pages: 28
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Times-Roman CMMI12 Times-Bold Times-Italic Symbol
%%+ Courier Courier-Bold Courier-Oblique CMSY10 Courier-BoldOblique
%%+ Times-BoldItalic
%%DocumentPaperSizes: a4
%%EndComments
%DVIPSWebPage: (www.radicaleye.com)
%DVIPSCommandLine: dvips -t a4 -o papi.ps papi.dvi
%DVIPSParameters: dpi=600, compressed
%DVIPSSource:  TeX output 2006.06.08:1101
%%BeginProcSet: texc.pro
%!
/TeXDict 300 dict def TeXDict begin/N{def}def/B{bind def}N/S{exch}N/X{S
N}B/A{dup}B/TR{translate}N/isls false N/vsize 11 72 mul N/hsize 8.5 72
mul N/landplus90{false}def/@rigin{isls{[0 landplus90{1 -1}{-1 1}ifelse 0
0 0]concat}if 72 Resolution div 72 VResolution div neg scale isls{
landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div hsize
mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul TR[
matrix currentmatrix{A A round sub abs 0.00001 lt{round}if}forall round
exch round exch]setmatrix}N/@landscape{/isls true N}B/@manualfeed{
statusdict/manualfeed true put}B/@copies{/#copies X}B/FMat[1 0 0 -1 0 0]
N/FBB[0 0 0 0]N/nn 0 N/IEn 0 N/ctr 0 N/df-tail{/nn 8 dict N nn begin
/FontType 3 N/FontMatrix fntrx N/FontBBox FBB N string/base X array
/BitMaps X/BuildChar{CharBuilder}N/Encoding IEn N end A{/foo setfont}2
array copy cvx N load 0 nn put/ctr 0 N[}B/sf 0 N/df{/sf 1 N/fntrx FMat N
df-tail}B/dfs{div/sf X/fntrx[sf 0 0 sf neg 0 0]N df-tail}B/E{pop nn A
definefont setfont}B/Cw{Cd A length 5 sub get}B/Ch{Cd A length 4 sub get
}B/Cx{128 Cd A length 3 sub get sub}B/Cy{Cd A length 2 sub get 127 sub}
B/Cdx{Cd A length 1 sub get}B/Ci{Cd A type/stringtype ne{ctr get/ctr ctr
1 add N}if}B/id 0 N/rw 0 N/rc 0 N/gp 0 N/cp 0 N/G 0 N/CharBuilder{save 3
1 roll S A/base get 2 index get S/BitMaps get S get/Cd X pop/ctr 0 N Cdx
0 Cx Cy Ch sub Cx Cw add Cy setcachedevice Cw Ch true[1 0 0 -1 -.1 Cx
sub Cy .1 sub]/id Ci N/rw Cw 7 add 8 idiv string N/rc 0 N/gp 0 N/cp 0 N{
rc 0 ne{rc 1 sub/rc X rw}{G}ifelse}imagemask restore}B/G{{id gp get/gp
gp 1 add N A 18 mod S 18 idiv pl S get exec}loop}B/adv{cp add/cp X}B
/chg{rw cp id gp 4 index getinterval putinterval A gp add/gp X adv}B/nd{
/cp 0 N rw exit}B/lsh{rw cp 2 copy get A 0 eq{pop 1}{A 255 eq{pop 254}{
A A add 255 and S 1 and or}ifelse}ifelse put 1 adv}B/rsh{rw cp 2 copy
get A 0 eq{pop 128}{A 255 eq{pop 127}{A 2 idiv S 128 and or}ifelse}
ifelse put 1 adv}B/clr{rw cp 2 index string putinterval adv}B/set{rw cp
fillstr 0 4 index getinterval putinterval adv}B/fillstr 18 string 0 1 17
{2 copy 255 put pop}for N/pl[{adv 1 chg}{adv 1 chg nd}{1 add chg}{1 add
chg nd}{adv lsh}{adv lsh nd}{adv rsh}{adv rsh nd}{1 add adv}{/rc X nd}{
1 add set}{1 add clr}{adv 2 chg}{adv 2 chg nd}{pop nd}]A{bind pop}
forall N/D{/cc X A type/stringtype ne{]}if nn/base get cc ctr put nn
/BitMaps get S ctr S sf 1 ne{A A length 1 sub A 2 index S get sf div put
}if put/ctr ctr 1 add N}B/I{cc 1 add D}B/bop{userdict/bop-hook known{
bop-hook}if/SI save N @rigin 0 0 moveto/V matrix currentmatrix A 1 get A
mul exch 0 get A mul add .99 lt{/QV}{/RV}ifelse load def pop pop}N/eop{
SI restore userdict/eop-hook known{eop-hook}if showpage}N/@start{
userdict/start-hook known{start-hook}if pop/VResolution X/Resolution X
1000 div/DVImag X/IEn 256 array N 2 string 0 1 255{IEn S A 360 add 36 4
index cvrs cvn put}for pop 65781.76 div/vsize X 65781.76 div/hsize X}N
/p{show}N/RMat[1 0 0 -1 0 0]N/BDot 260 string N/Rx 0 N/Ry 0 N/V{}B/RV/v{
/Ry X/Rx X V}B statusdict begin/product where{pop false[(Display)(NeXT)
(LaserWriter 16/600)]{A length product length le{A length product exch 0
exch getinterval eq{pop true exit}if}{pop}ifelse}forall}{false}ifelse
end{{gsave TR -.1 .1 TR 1 1 scale Rx Ry false RMat{BDot}imagemask
grestore}}{{gsave TR -.1 .1 TR Rx Ry scale 1 1 false RMat{BDot}
imagemask grestore}}ifelse B/QV{gsave newpath transform round exch round
exch itransform moveto Rx 0 rlineto 0 Ry neg rlineto Rx neg 0 rlineto
fill grestore}B/a{moveto}B/delta 0 N/tail{A/delta X 0 rmoveto}B/M{S p
delta add tail}B/b{S p tail}B/c{-4 M}B/d{-3 M}B/e{-2 M}B/f{-1 M}B/g{0 M}
B/h{1 M}B/i{2 M}B/j{3 M}B/k{4 M}B/w{0 rmoveto}B/l{p -4 w}B/m{p -3 w}B/n{
p -2 w}B/o{p -1 w}B/q{p 1 w}B/r{p 2 w}B/s{p 3 w}B/t{p 4 w}B/x{0 S
rmoveto}B/y{3 2 roll p a}B/bos{/SS save N}B/eos{SS restore}B end

%%EndProcSet
%%BeginProcSet: 8r.enc
% File  8r.enc as of 2002-03-12 for PSNFSS 9
%
% This is the encoding vector for Type1 and TrueType fonts to be used
% with TeX.  This file is part of the PSNFSS bundle, version 9
% 
% Authors: S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry, W. Schmidt
%
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida + Euro.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
%
% (6) /Euro is assigned to 128, as in Windows ANSI
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /Euro /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def

%%EndProcSet
%%BeginProcSet: aae443f0.enc
% Thomas Esser, Dec 2002. public domain
%
% Encoding for:
%     cmmi10 cmmi12 cmmi5 cmmi6 cmmi7 cmmi8 cmmi9 cmmib10
%
/TeXaae443f0Encoding [
/Gamma /Delta /Theta /Lambda /Xi /Pi /Sigma /Upsilon /Phi /Psi /Omega
/alpha /beta /gamma /delta /epsilon1 /zeta /eta /theta /iota /kappa
/lambda /mu /nu /xi /pi /rho /sigma /tau /upsilon /phi /chi /psi
/omega /epsilon /theta1 /pi1 /rho1 /sigma1 /phi1 /arrowlefttophalf
/arrowleftbothalf /arrowrighttophalf /arrowrightbothalf /arrowhookleft
/arrowhookright /triangleright /triangleleft /zerooldstyle /oneoldstyle
/twooldstyle /threeoldstyle /fouroldstyle /fiveoldstyle /sixoldstyle
/sevenoldstyle /eightoldstyle /nineoldstyle /period /comma /less /slash
/greater /star /partialdiff /A /B /C /D /E /F /G /H /I /J /K /L /M /N
/O /P /Q /R /S /T /U /V /W /X /Y /Z /flat /natural /sharp /slurbelow
/slurabove /lscript /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o /p
/q /r /s /t /u /v /w /x /y /z /dotlessi /dotlessj /weierstrass /vector
/tie /psi /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/space /Gamma /Delta /Theta /Lambda /Xi /Pi /Sigma /Upsilon /Phi /Psi
/.notdef /.notdef /Omega /alpha /beta /gamma /delta /epsilon1 /zeta /eta
/theta /iota /kappa /lambda /mu /nu /xi /pi /rho /sigma /tau /upsilon
/phi /chi /psi /tie /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef
] def

%%EndProcSet
%%BeginProcSet: bbad153f.enc
% Thomas Esser, Dec 2002. public domain
%
% Encoding for:
%     cmsy10 cmsy5 cmsy6 cmsy7 cmsy8 cmsy9
%
/TeXbbad153fEncoding [
/minus /periodcentered /multiply /asteriskmath /divide /diamondmath
/plusminus /minusplus /circleplus /circleminus /circlemultiply
/circledivide /circledot /circlecopyrt /openbullet /bullet
/equivasymptotic /equivalence /reflexsubset /reflexsuperset /lessequal
/greaterequal /precedesequal /followsequal /similar /approxequal
/propersubset /propersuperset /lessmuch /greatermuch /precedes /follows
/arrowleft /arrowright /arrowup /arrowdown /arrowboth /arrownortheast
/arrowsoutheast /similarequal /arrowdblleft /arrowdblright /arrowdblup
/arrowdbldown /arrowdblboth /arrownorthwest /arrowsouthwest /proportional
/prime /infinity /element /owner /triangle /triangleinv /negationslash
/mapsto /universal /existential /logicalnot /emptyset /Rfractur /Ifractur
/latticetop /perpendicular /aleph /A /B /C /D /E /F /G /H /I /J /K
/L /M /N /O /P /Q /R /S /T /U /V /W /X /Y /Z /union /intersection
/unionmulti /logicaland /logicalor /turnstileleft /turnstileright
/floorleft /floorright /ceilingleft /ceilingright /braceleft /braceright
/angbracketleft /angbracketright /bar /bardbl /arrowbothv /arrowdblbothv
/backslash /wreathproduct /radical /coproduct /nabla /integral
/unionsq /intersectionsq /subsetsqequal /supersetsqequal /section
/dagger /daggerdbl /paragraph /club /diamond /heart /spade /arrowleft
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/minus /periodcentered /multiply /asteriskmath /divide /diamondmath
/plusminus /minusplus /circleplus /circleminus /.notdef /.notdef
/circlemultiply /circledivide /circledot /circlecopyrt /openbullet
/bullet /equivasymptotic /equivalence /reflexsubset /reflexsuperset
/lessequal /greaterequal /precedesequal /followsequal /similar
/approxequal /propersubset /propersuperset /lessmuch /greatermuch
/precedes /follows /arrowleft /spade /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
/.notdef /.notdef /.notdef /.notdef /.notdef /.notdef /.notdef
] def

%%EndProcSet
%%BeginProcSet: texps.pro
%!
TeXDict begin/rf{findfont dup length 1 add dict begin{1 index/FID ne 2
index/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]FontType 0
ne{/Metrics exch def dict begin Encoding{exch dup type/integertype ne{
pop pop 1 sub dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get
div def}ifelse}forall Metrics/Metrics currentdict end def}{{1 index type
/nametype eq{exit}if exch pop}loop}ifelse[2 index currentdict end
definefont 3 -1 roll makefont/setfont cvx]cvx def}def/ObliqueSlant{dup
sin S cos div neg}B/SlantFont{4 index mul add}def/ExtendFont{3 -1 roll
mul exch}def/ReEncodeFont{CharStrings rcheck{/Encoding false def dup[
exch{dup CharStrings exch known not{pop/.notdef/Encoding true def}if}
forall Encoding{]exch pop}{cleartomark}ifelse}if/Encoding exch def}def
end

%%EndProcSet
%%BeginFont: CMSY10
%!PS-AdobeFont-1.1: CMSY10 1.0
%%CreationDate: 1991 Aug 15 07:20:57
% Copyright (C) 1997 American Mathematical Society. All Rights Reserved.
11 dict begin
/FontInfo 7 dict dup begin
/version (1.0) readonly def
/Notice (Copyright (C) 1997 American Mathematical Society. All Rights Reserved) readonly def
/FullName (CMSY10) readonly def
/FamilyName (Computer Modern) readonly def
/Weight (Medium) readonly def
/ItalicAngle -14.035 def
/isFixedPitch false def
end readonly def
/FontName /CMSY10 def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding 256 array
0 1 255 {1 index exch /.notdef put} for
dup 0 /.notdef put
readonly def
/FontBBox{-29 -960 1116 775}readonly def
/UniqueID 5000820 def
currentdict end
currentfile eexec
D9D66F633B846A97B686A97E45A3D0AA052F09F9C8ADE9D907C058B87E9B6964
7D53359E51216774A4EAA1E2B58EC3176BD1184A633B951372B4198D4E8C5EF4
A213ACB58AA0A658908035BF2ED8531779838A960DFE2B27EA49C37156989C85
E21B3ABF72E39A89232CD9F4237FC80C9E64E8425AA3BEF7DED60B122A52922A
221A37D9A807DD01161779DDE7D31FF2B87F97C73D63EECDDA4C49501773468A
27D1663E0B62F461F6E40A5D6676D1D12B51E641C1D4E8E2771864FC104F8CBF
5B78EC1D88228725F1C453A678F58A7E1B7BD7CA700717D288EB8DA1F57C4F09
0ABF1D42C5DDD0C384C7E22F8F8047BE1D4C1CC8E33368FB1AC82B4E96146730
DE3302B2E6B819CB6AE455B1AF3187FFE8071AA57EF8A6616B9CB7941D44EC7A
71A7BB3DF755178D7D2E4BB69859EFA4BBC30BD6BB1531133FD4D9438FF99F09
4ECC068A324D75B5F696B8688EEB2F17E5ED34CCD6D047A4E3806D000C199D7C
515DB70A8D4F6146FE068DC1E5DE8BC570317AAEA74A842CFD26F9591866F5A0
9B4EAD7C4C4D6CBC02869406866027BB86F9AE78254830409624210C2FCAD587
24CA21C681EB9BE7166A0EC7A56165148885525114AAAF78C7A340D62D6391D1
2C4AF69F8200B980E962A7BC77741F074808250C53692972139820504E857223
071084B049097C0708DDE1C7EB218F7DE11C3E0D87BF43DFBFB36B0C0DB084DF
9BA115782EA4B30B3F7C25CA34AEBDE66545E4AF59724CFA6D793806316811BA
95B344EA88B288825AA8BF80DD77255C8ADE620281725E0D82A39DB94B8EF94C
217BAA289670CE7888CAB8C0C2EE801BF0CC8B50C334B64EE52F26813BD1ABA6
7D9D59C873666169A35E5581C8025DC68CF3022DFC21A6B5D4D00F2518841263
B4832257C4B83B8316D461B3CD3D92FDFDDC83966670DABD422D28B99C286E50
749107436ECEB6430323DE3A79C2DC6AB5BFAE4C46C40DFC8D89596E574CA56B
AF10DC4D6C0F9FA0A230F37D8B49759FD3EC69B4802AB69723A106322E2FC640
F577EA4F1D5F7AF70A24CEF293158ED076AE97F65613A2743A73015ACFB8FCA4
75EE2BC7061E47AE9441A75ED8BAC6F43AA99610031F5B6DC0A89E5BA7120609
AFC1F490E6647F596DC440968E0B3549226479FBA161497D628A106D00A0A10A
D8DE8E118DF21D72EB2508792DB9283DB4DAFC31113CE6BCE9BF5ECEA7DE8193
1AF1A8C0B5E5E32506261E6CD406277D49DD9FC32D3A544AE199BC1DC39C5F7D
E9CE225742CCF90A4D1EB1AF968802A0400E0E28CAD0050C7093615476977EC1
622161D1105B6EC97617226B0592AB408F55F461A2D0A9CE1A9CF6AF1535DD3E
623E8F01F2C5D4EC0BB9F1E9B1D02BF88FC57C3ADE12
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark
%%EndFont 
%%BeginFont: CMMI12
%!PS-AdobeFont-1.1: CMMI12 1.100
%%CreationDate: 1996 Jul 27 08:57:55
% Copyright (C) 1997 American Mathematical Society. All Rights Reserved.
11 dict begin
/FontInfo 7 dict dup begin
/version (1.100) readonly def
/Notice (Copyright (C) 1997 American Mathematical Society. All Rights Reserved) readonly def
/FullName (CMMI12) readonly def
/FamilyName (Computer Modern) readonly def
/Weight (Medium) readonly def
/ItalicAngle -14.04 def
/isFixedPitch false def
end readonly def
/FontName /CMMI12 def
/PaintType 0 def
/FontType 1 def
/FontMatrix [0.001 0 0 0.001 0 0] readonly def
/Encoding 256 array
0 1 255 {1 index exch /.notdef put} for
dup 0 /.notdef put
readonly def
/FontBBox{-30 -250 1026 750}readonly def
/UniqueID 5087386 def
currentdict end
currentfile eexec
D9D66F633B846A97B686A97E45A3D0AA0529731C99A784CCBE85B4993B2EEBDE
3B12D472B7CF54651EF21185116A69AB1096ED4BAD2F646635E019B6417CC77B
532F85D811C70D1429A19A5307EF63EB5C5E02C89FC6C20F6D9D89E7D91FE470
B72BEFDA23F5DF76BE05AF4CE93137A219ED8A04A9D7D6FDF37E6B7FCDE0D90B
986423E5960A5D9FBB4C956556E8DF90CBFAEC476FA36FD9A5C8175C9AF513FE
D919C2DDD26BDC0D99398B9F4D03D6A8F05B47AF95EF28A9C561DBDC98C47CF5
5250011D19E9366EB6FD153D3A100CAA6212E3D5D93990737F8D326D347B7EDC
4391C9DF440285B8FC159D0E98D4258FC57892DCC57F7903449E07914FBE9E67
3C15C2153C061EB541F66C11E7EE77D5D77C0B11E1AC55101DA976CCACAB6993
EED1406FBB7FF30EAC9E90B90B2AF4EC7C273CA32F11A5C1426FF641B4A2FB2F
4E68635C93DB835737567FAF8471CBC05078DCD4E40E25A2F4E5AF46C234CF59
2A1CE8F39E1BA1B2A594355637E474167EAD4D97D51AF0A899B44387E1FD933A
323AFDA6BA740534A510B4705C0A15647AFBF3E53A82BF320DD96753639BE49C
2F79A1988863EF977B800C9DB5B42039C23EB86953713F730E03EA22FF7BB2C1
D97D33FD77B1BDCC2A60B12CF7805CFC90C5B914C0F30A673DF9587F93E47CEA
5932DD1930560C4F0D97547BCD805D6D854455B13A4D7382A22F562D7C55041F
0FD294BDAA1834820F894265A667E5C97D95FF152531EF97258F56374502865D
A1E7C0C5FB7C6FB7D3C43FEB3431095A59FBF6F61CEC6D6DEE09F4EB0FD70D77
2A8B0A4984C6120293F6B947944BE23259F6EB64303D627353163B6505FC8A60
00681F7A3968B6CBB49E0420A691258F5E7B07B417157803FCBE9B9FB1F80FD8
CA0DA1186446DD565542BCCC7D339A1EB34C7F49246E8D72E987EB477C6DB757
99AF86CEBCD7605C487A00CD2CD093098182DC57B20D78ECE0BECF3A0BF88EBA
C866DB19F34BBBED6634AFC0F08D2AFB2A92578A6F8B4ADCD6594737FF6EED7D
5B536DA9E3E2CADB40DB7C600EA4D100D33C3B92B1CF857E012C4EB370BA8295
55B50047CD58E912E67E22C1B92F41D0BEE742201DF198F3766AE35EA71D8195
A8C94D661C40D718CB09497485FAA34204229AECFE644C93FFDA54C789E4F751
3D2519F7CB9E79B2ABE3101DF2EBFAD375469CDC687FB3DC2833EDC0F946B41F
F28D72FFF2A9B8B0D76DC542537612E2BE0F3FB9601C897386359C55E867A547
F872005F5C56C6EC5E9685E03D7A82653BE8B69741C4DF332AEEB2AA450B23F3
EABD5ED060606CC7DB1762632EC3C6C4A66ADAF61A97D949DEA5156B4CF34765
67AC3F10AE17199A710A882D47979F9D41AA2CB794648BE47479F0B00E18BF04
923F54CEC1214BAFA39BB65ECB013875899E9901B7882D16D2E2C97AD3353668
A6070081E4DC627AF9192599F5876369908FBDFA11E8D6CB2E83896E9C897CEC
FD1D25651D66A333AF531FF74E1B0DEB1E3D1B5B7D3FB9D1C8BF60517B31C8D2
1C264F44BC9AF3D9BA5280D1618EED96C11ED24F789FAA263394C658DFCA8DE9
D47D9E188E212F9EC1DCF449DFDAB8437FAB9EA9AF01AE1714E8F932855182
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
cleartomark
%%EndFont 
TeXDict begin 39158280 55380996 1000 600 600 (papi.dvi)
@start /Fa 144[50 30[61 8[72 5[66 65[{ TeXBase1Encoding ReEncodeFont }4
99.6264 /Times-BoldItalic rf /Fb 75[33 58[50 50 72 50
55 33 39 44 55 55 50 55 83 28 2[28 55 50 33 44 55 44
55 50 11[72 1[55 72 1[61 3[66 2[39 2[61 66 72 2[72 15[50
50 2[33 42[55 2[{ TeXBase1Encoding ReEncodeFont }38 99.6264
/Times-Bold rf /Fc 138[60 1[60 60 3[60 1[60 2[60 1[60
3[60 60 50[60 1[60 45[{ TeXBase1Encoding ReEncodeFont }11
99.6264 /Courier-BoldOblique rf /Fd 145[50 6[50 50 102[{
 TeXbbad153fEncoding ReEncodeFont }3 99.6264 /CMSY10
rf /Fe 134[60 1[60 60 60 60 60 60 60 60 60 60 60 60 2[60
60 60 60 60 60 60 60 60 3[60 1[60 1[60 4[60 60 2[60 60
2[60 2[60 1[60 3[60 1[60 17[60 60 60 60 44[{
 TeXBase1Encoding ReEncodeFont }38 99.6264 /Courier-Oblique
rf /Ff 193[76 1[76 60[{ TeXaae443f0Encoding ReEncodeFont }2
99.6264 /CMMI12 rf /Fg 103[60 15[60 13[60 60 60 60 60
60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60
60 60 60 3[60 1[60 1[60 60 60 60 60 60 60 60 60 60 60
60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60
60 60 60 60 60 60 60 60 60 1[60 60 60 60 60 60 60 1[60
60 60 60 60 1[60 1[60 34[{ TeXBase1Encoding ReEncodeFont }82
99.6264 /Courier-Bold rf /Fh 75[51 27[51 27[51 1[51 51
51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 2[51 1[51 1[51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51
51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51 51
51 51 51 1[51 51 51 51 51 51 51 51 51 51 15[51 17[{
 .85 ExtendFont TeXBase1Encoding ReEncodeFont }89 99.6264
/Courier rf /Fj 75[40 58[60 60 86 60 66 40 47 53 1[66
60 66 100 33 2[33 1[60 40 53 66 53 66 60 7[86 1[120 86
1[80 66 86 1[73 93 86 113 80 3[93 93 1[80 86 86 1[86
9[60 60 60 60 60 60 60 2[30 4[40 40 22[33 17[{
 TeXBase1Encoding ReEncodeFont }50 119.552 /Times-Bold
rf /Fk 75[33 90[72 3[72 61 55 66 1[55 72 72 1[61 2[33
1[72 55 61 72 66 1[72 13[50 50 50 12[50 36[{
 .167 SlantFont TeXBase1Encoding ReEncodeFont }21 99.6264
/Times-Roman rf /Fl 75[33 31[55 26[44 44 66 44 50 28
39 39 1[50 50 50 72 28 44 28 28 50 50 28 44 50 44 50
50 11[72 55 50 61 1[61 72 66 83 55 66 1[33 72 72 61 61
72 66 1[61 3[67 2[33 5[50 50 50 50 50 28 25 33 25 2[33
33 33 36[50 2[{ TeXBase1Encoding ReEncodeFont }59 99.6264
/Times-Italic rf /Fm 75[33 27[33 3[44 44 24[44 50 50
72 50 50 28 39 33 50 50 50 50 78 28 50 28 28 50 50 33
44 50 44 50 44 3[33 1[33 1[72 1[94 1[72 61 55 66 1[55
72 72 89 61 2[33 72 72 55 61 72 66 66 72 3[56 2[28 50
50 50 50 50 50 50 50 50 50 28 25 33 25 2[33 33 4[50 17[28
14[55 2[{ TeXBase1Encoding ReEncodeFont }73 99.6264 /Times-Roman
rf /Fn 75[48 58[72 3[80 48 56 64 1[80 72 80 1[40 2[40
1[72 1[64 80 64 1[72 23[56 21[72 72 72 2[36 43[80 2[{
 TeXBase1Encoding ReEncodeFont }22 143.462 /Times-Bold
rf /Fo 75[30 57[40 45 1[66 45 45 25 35 30 45 45 45 45
71 25 1[25 25 1[45 1[40 45 40 45 40 11[66 2[61 1[51 5[35
30 3[56 1[61 1[66 18[23 43[51 2[{ TeXBase1Encoding ReEncodeFont }33
90.9091 /Times-Roman rf /Fp 138[51 1[35 4[51 76 7[40
18[66 82[{ TeXBase1Encoding ReEncodeFont }6 90.9091 /Times-Bold
rf /Fq 193[91 1[91 60[{ TeXaae443f0Encoding ReEncodeFont }2
119.552 /CMMI12 rf /Fr 75[40 57[53 4[60 1[47 40 1[60
60 60 93 2[33 33 3[53 60 53 1[53 16[66 5[47 6[80 2[110
7[60 1[60 3[60 1[60 1[30 46[{ TeXBase1Encoding ReEncodeFont }24
119.552 /Times-Roman rf /Fs 75[57 58[86 3[86 48 67 57
86 1[86 86 1[48 2[48 1[86 1[76 86 76 1[76 16[96 6[57
7[124 62[96 2[{ TeXBase1Encoding ReEncodeFont }20 172.188
/Times-Roman rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%BeginPaperSize: a4
a4
%%EndPaperSize
 end
%%EndSetup
%%Page: 1 1
TeXDict begin 1 0 bop 211 814 a Fs(Instalaci)807 813
y(\264)793 814 y(on)45 b(y)e(con\002guraci)1926 813 y(\264)1912
814 y(on)i(de)f(una)f(arquitectura)1651 1021 y(P)-16
b(API)763 1320 y Fr(Jaime)29 b(P)1144 1319 y(\264)1137
1320 y(erez)i(Crespo)d Fq(<)p Fr(jaime.perez@urjc.es)p
Fq(>)1385 1554 y Fr(8)i(de)f(junio)h(de)g(2006)1651 1917
y Fp(Resumen)500 2085 y Fo(Este)20 b(documento)i(cubre)e(la)g
(instalaci)8 b(\264)-38 b(on)23 b(y)c(con\002guraci)8
b(\264)-38 b(on)23 b(de)c(una)h(arquitectura)j(P)-8 b(API)364
2198 y(de)22 b(servicios)i(web)l(.)e(A)f(lo)h(lar)n(go)i(del)e(mismo)g
(se)g(utilizar)5 b(\264)-35 b(an)25 b(ejemplos)e(y)f(casos)h(reales)g
(de)f(la)364 2311 y(implantaci)8 b(\264)-38 b(on)26 b(de)e(P)-8
b(API)21 b(en)j(la)f(Uni)n(v)o(ersidad)j(Re)o(y)c(Juan)j(Carlos.)120
2650 y Fn(1.)143 b(Intr)m(oducci)1028 2648 y(\264)1016
2650 y(on)266 2873 y Fm(P)-9 b(API)23 b(es)f(un)g(sistema)e(que)i
(permite)g(la)f(autenticaci)8 b(\264)-41 b(on)22 b(y)f(autorizaci)8
b(\264)-41 b(on)22 b(de)g(usuarios)f(a)h(tra)n(v)6 b(\264)-39
b(es)120 2994 y(de)30 b(una)g(red)h(de)f(servicios)f(web)l(.)h(Sus)g
(principales)g(bazas,)g(en)g(las)g(que)g(nos)g(centraremos)g(aqu)m
(\264)-30 b(\021,)120 3114 y(son)23 b(la)h(implementaci)8
b(\264)-41 b(on)22 b(del)h(concepto)h Fl(single-sign-on)e
Fm(\(s)8 b(\264)-41 b(olo)23 b(es)h(necesario)g(autenticarse)f(una)120
3234 y(v)o(ez)j(para)g(acceder)h(a)f(todos)f(los)g(servicios)g
(ofrecidos\))h(y)f(la)h(capacidad)g(de)g(actuar)g(como)g(proxy)120
3355 y(de)f(reescritura)g(transparente)f(al)h(usuario,)f(de)h(forma)f
(que)h(permite)f(anteponerse)h(a)g(pol)m(\264)-30 b(\021ticas)23
b(de)120 3475 y(acceso)i(de)g(\002ltrado)g(por)g(IP)g(de)g(origen)g
(mediante)f(una)h(autenticaci)8 b(\264)-41 b(on)24 b(pre)n(via.)266
3596 y(La)e(arquitectura)f(de)h(P)-9 b(API)22 b(utiliza)e(una)h(serie)h
(de)f(conceptos)g(que)h(es)f(necesario)h(tener)f(claros)120
3716 y(en)k(todo)f(momento)f(a)i(la)g(hora)g(de)g(implantar)f(un)g
(servicio)h(con)30 b(\264)-38 b(el.)191 3937 y(1.)98
b Fl(Servidor)37 b(de)h(autenticaci)1329 3938 y(\264)1321
3937 y(on)e Fm(o)h Fl(AS)p Fm(.)h(Es)f(el)h(encar)n(gado)g(de)f
(autenticar)h(a)g(los)f(usuarios)364 4057 y(en)27 b(un)35
b(\264)-41 b(unico)27 b(punto)f(de)h(la)h(red,)f(de)g(la)h(forma)f(que)
g(se)g(desee,)h(y)f(recolectar)h(informaci)8 b(\264)-41
b(on)364 4178 y(sobre)20 b(los)f(mismos)g(para)h(proporcion)6
b(\264)-39 b(arsela)20 b(a)g(los)g(puntos)f(de)h(acceso.)g(Emite)g
Fl(aser)l(ciones)364 4298 y Fm(con)31 b(la)g(informaci)8
b(\264)-41 b(on)30 b(necesaria)i(para)g(v)o(eri\002car)g(la)f
(identidad)f(de)h(los)g(usuarios.)f(Por)h(lo)364 4419
y(general,)h(consulta)g(un)g(\002chero)h(con)f(usuarios,)g(una)g(base)h
(de)f(datos,)g(o)g(un)g(LD)l(AP)h(para)364 4539 y(autenticar)-5
b(.)191 4741 y(2.)98 b Fl(Puntos)30 b(de)h(acceso)g Fm(o)g
Fl(P)-8 b(oA)p Fm(.)31 b(Son)g(los)g(encar)n(gados)g(de)g(prote)o(ger)g
(el)g(acceso)h(a)f(un)g(recur)n(-)364 4861 y(so)36 b(concreto.)g
(Utilizan)f(las)g Fl(aser)l(ciones)h Fm(de)g(los)f Fl(servidor)l(es)h
(de)g(autenticaci)3167 4862 y(\264)3159 4861 y(on)f Fm(en)h(los)364
4981 y(que)g(conf)m(\264)-30 b(\021an)36 b(para)h(v)o(eri\002car)g(la)f
(identidad)f(de)i(sus)e(usuarios)h(y)g(obtener)g(informaci)8
b(\264)-41 b(on)364 5102 y(adicional)38 b(sobre)h(los)f(mismos.)f(Un)i
Fl(punto)f(de)h(acceso)g Fm(garantizar)6 b(\264)-39 b(a)39
b(el)g(acceso)g(al)g(re-)364 5222 y(curso)30 b(que)h(prote)o(ge)e
(siempre)h(y)h(cuando)f(alg)8 b(\264)-41 b(un)30 b Fl(servidor)g(de)g
(autenticaci)3048 5223 y(\264)3040 5222 y(on)f Fm(en)i(el)f(que)364
5342 y(conf)m(\264)-30 b(\021a)24 b(le)f(proporcione)h(una)f
Fl(aser)l(ci)1653 5343 y(\264)1645 5342 y(on)h Fm(indicando)f(que)g(ha)
h(autenticado)f(pre)n(viamente)g(al)364 5463 y(usuario,)32
b(y)h(utilizando)e(la)i(informaci)8 b(\264)-41 b(on)32
b(adicional)g(que)38 b(\264)-38 b(este)33 b(le)g(puede)f(disponer)h
(para)1805 5712 y(1)p eop end
%%Page: 2 2
TeXDict begin 2 1 bop 120 100 a Fk(1)99 b(INTR)l(ODUCCI)903
77 y(\264)878 100 y(ON)2468 b Fm(2)364 407 y(autorizaci)8
b(\264)-41 b(on.)33 b(Los)h Fl(P)-8 b(oA)33 b Fm(pueden)h(funcionar)g
(de)g(m)8 b(\264)-41 b(ultiples)32 b(formas,)i(dependiendo)f(de)364
527 y(los)24 b(requisitos)f(de)i(la)g(aplicaci)8 b(\264)-41
b(on)25 b(que)f(se)h(quiere)g(prote)o(ger:)397 756 y
Fl(a)p Fm(\))98 b Fl(P)-8 b(oA)27 b Fm(con)l(v)o(encional.)f(Escrito)g
(en)h(Perl,)h(se)f(inte)o(gra)f(directamente)h(con)g(el)g(servidor)578
876 y(web)i(Apache)g(\(v)o(ersiones)f(1.x,)g(la)h(rama)g(2.x)g(no)f
(est)6 b(\264)-39 b(a)29 b(soportada)f(hasta)g(la)h(fecha\).)578
996 y(Este)35 b(tipo)f(de)h Fl(P)-8 b(oA)35 b Fm(permite)f(usar)h(los)f
(mecanismos)g(propios)g(del)h(servidor)f(web)578 1117
y(para)28 b(permitir)e(el)h(acceso)h(a)f(la)h(aplicaci)8
b(\264)-41 b(on)26 b(que)h(sirv)o(e)g(el)g(mismo)e(o)i(dene)o(garla)g
(uti-)578 1237 y(lizando)e(una)f(simple)g(p)6 b(\264)-39
b(agina)25 b(de)g(error)g Fl(HTTP)g(403)g(F)-10 b(orbidden)p
Fm(.)397 1399 y Fl(b)p Fm(\))98 b Fl(P)-8 b(oA)28 b Fm(en)h(modo)e
(proxy)h(de)g(reescritura.)g(En)g(este)h(caso,)f(el)g
Fl(P)-8 b(oA)28 b Fm(prote)o(ge)f(el)h(acceso)578 1519
y(a)35 b(una)e(aplicaci)8 b(\264)-41 b(on)34 b(remota)f(que)h(no)f(se)h
(encuentra)g(en)g(su)g(mismo)e(servidor)h(web)l(.)578
1640 y(El)h Fl(P)-8 b(oA)33 b Fm(act)8 b(\264)-41 b(ua)34
b(como)f(un)h(proxy)f(web)h(con)l(v)o(encional,)e(editando)h(los)g
(contenidos)578 1760 y(HTML)23 b(que)f(sirv)o(e)g(para)i(que)e(los)g
(enlaces)i(hagan)e(referencia)i(a)k(\264)-38 b(el)23
b(mismo)e(en)i(lugar)578 1880 y(de)32 b(al)f(servicio)f(\002nal)h(que)g
(se)g(prote)o(ge.)f(Su)i(principal)e(uso)g(consiste)g(en)i(dar)f(acce-)
578 2001 y(so)j(autenticado)f(a)h(aplicaciones)f(con)h(\002ltrado)f
(por)h(IP)g(de)g(origen,)f(por)h(ejemplo,)578 2121 y(p)6
b(\264)-39 b(aginas)25 b(con)g(recursos)g(bibliogr)6
b(\264)-39 b(a\002cos)24 b(a)h(las)g(que)g(se)g(puede)g(acceder)34
b(\264)-41 b(unicamente)578 2242 y(desde)25 b(direcciones)g(IP)g
(suscritas.)402 2403 y Fl(c)p Fm(\))99 b Fl(P)-8 b(oA)24
b Fm(con)f(autocompletado)f(de)i(formularios.)f(En)g(caso)h(de)f(un)h
Fl(P)-8 b(oA)23 b Fm(que,)g(actuando)578 2524 y(como)d(proxy)g(de)g
(reescritura,)g(necesite)g(un)g(ni)n(v)o(el)e(de)j(autenticaci)8
b(\264)-41 b(on)19 b(m)6 b(\264)-39 b(as)20 b(impuesto)578
2644 y(por)25 b(la)g(aplicaci)8 b(\264)-41 b(on)24 b(prote)o(gida)g
(\(t)m(\264)-30 b(\021picamente,)24 b(nombre)g(de)h(usuario)f(y)h
(contrase)8 b(\230)-41 b(na\),)578 2765 y(el)21 b(autocompletado)d(de)i
(formularios)g(permite)f(obtener)h(la)g(informaci)8 b(\264)-41
b(on)19 b(necesaria)578 2885 y(de)30 b(las)g(aserciones)g(realizadas)g
(por)g(el)f Fl(AS)p Fm(,)h(pudiendo)e(as)m(\264)-30 b(\021)30
b(rellenar)g(de)g(forma)g(au-)578 3005 y(tom)6 b(\264)-39
b(atica)22 b(y)f(transparente)h(los)f(formularios)g(necesarios.)2630
2984 y(\264)2611 3005 y(Util)g(en)h(casos)g(en)g(los)f(que)578
3126 y(se)33 b(desea)g(prote)o(ger)f(una)h(aplicaci)8
b(\264)-41 b(on)32 b(remota)h(con)f(el)h(proxy)f(de)h(reescritura,)g(a)
g(la)578 3246 y(que)24 b(no)g(se)f(tiene)h(acceso)g(para)h(inte)o(grar)
e(directamente)g(con)h(P)-9 b(API,)24 b(y)g(que)g(requiere)578
3367 y(al)h(usuario)g(identi\002carse)f(de)h(alguna)g(manera)g
(adicional.)394 3528 y Fl(d)s Fm(\))98 b Fl(P)-8 b(oA)38
b Fm(en)g(PHP)-11 b(.)38 b(Una)g(v)o(ersi)8 b(\264)-41
b(on)36 b(reducida)i(de)g(un)f(punto)g(de)h(acceso,)g(que)g(permite)578
3649 y(autenticar)21 b(a)g(un)f(usuario)g(mediante)g(la)h(arquitectura)
f(P)-9 b(API,)21 b(desde)g(una)g(aplicaci)8 b(\264)-41
b(on)578 3769 y(escrita)28 b(en)g(PHP)h(y)f(mediante)f(una)h(simple)e
(llamada)i(a)g(una)g(funci)8 b(\264)-41 b(on.)27 b(Su)h(uso)g(m)6
b(\264)-39 b(as)578 3890 y(generalizado)30 b(consiste)e(en)h(la)g(dele)
o(gaci)8 b(\264)-41 b(on)27 b(\(no)i(tiene)g(por)g(qu)6
b(\264)-39 b(e)29 b(ser)g(e)o(xclusi)n(v)n(a\))e(de)578
4010 y(la)e(autenticaci)8 b(\264)-41 b(on)24 b(en)h(P)-9
b(API)26 b(en)f(lugar)f(de)h(la)g(propia)f(aplicaci)8
b(\264)-41 b(on.)191 4238 y(3.)98 b Fl(Agrupaciones)28
b(de)h(puntos)g(de)g(acceso)h Fm(o)f Fl(GP)-8 b(oA)p
Fm(.)29 b(Se)h(trata)g(de)f(un)g Fl(P)-8 b(oA)29 b Fm(que)h(no)f(prote)
o(ge)364 4359 y(ning)8 b(\264)-41 b(un)34 b(recurso)i(en)f(concreto,)h
(y)f(en)g(su)g(lugar)g(da)g(acceso)h(a)g(un)f(grupo)g(de)g
Fl(P)-8 b(oAs)35 b Fm(con)364 4479 y(caracter)m(\264)-30
b(\021sticas)22 b(comunes)g(de)g(v)n(alidaci)8 b(\264)-41
b(on.)21 b(Permite)h(personalizar)h(la)f(cantidad)g(de)g(infor)n(-)364
4599 y(maci)8 b(\264)-41 b(on)26 b(del)h(usuario)g(que)g(se)g
(proporciona)f(a)i(los)e Fl(P)-8 b(oA)p Fm(,)27 b(interponi)6
b(\264)-39 b(endose)25 b(entre)33 b(\264)-38 b(estos)26
b(y)364 4720 y(el)33 b Fl(AS)p Fm(,)f(de)h(forma)f(que)h(cada)g
Fl(P)-8 b(oA)33 b Fm(reciba)g(e)o(xclusi)n(v)n(amente)d(la)j(informaci)
8 b(\264)-41 b(on)31 b(necesaria)364 4840 y(para)25 b(su)g(autenticaci)
8 b(\264)-41 b(on)24 b(y)h(autorizaci)8 b(\264)-41 b(on.)120
5068 y(P)o(ara)34 b(informaci)8 b(\264)-41 b(on)32 b(m)6
b(\264)-39 b(as)33 b(detallada)g(sobre)h(P)-9 b(API,)34
b(el)f(protocolo)f(subyacente)h(e)h(instalaci)8 b(\264)-41
b(on)32 b(y)120 5189 y(con\002guraci)8 b(\264)-41 b(on)26
b(del)g(sistema,)f(se)h(recomienda)f(consultar)h(el)g(sitio)e(web)i
(que)g Fl(RedIris)g Fm(dispone)f(a)120 5309 y(tal)g(efecto)g(en)g
Fl(http://papi.r)l(ediris.es/doc/)p Fm(.)p eop end
%%Page: 3 3
TeXDict begin 3 2 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(3)120 411 y Fn(2.)143
b(Instalaci)911 409 y(\264)899 411 y(on)33 b(y)j(con\002guraci)1892
409 y(\264)1880 411 y(on)266 635 y Fm(A)e(continuaci)8
b(\264)-41 b(on)33 b(se)i(proporcionan)e(algunas)g(consideraciones)h(b)
6 b(\264)-39 b(asicas)34 b(para)h(la)f(instala-)120 755
y(ci)8 b(\264)-41 b(on)31 b(de)g(todos)f(los)g(elementos)h(que)g
(componen)f(un)h(servicio)f(P)-9 b(API.)32 b(Como)f(con)l(v)o(enci)8
b(\264)-41 b(on,)30 b(los)120 875 y(comandos)24 b(se)h(indicar)6
b(\264)-39 b(an)24 b(precedidos)h(del)g Fl(pr)l(ompt)g
Fm(del)f(usuario)g Fl(r)l(oot)i Fm(\(#\).)120 1171 y
Fj(2.1.)119 b(Ser)o(vidor)31 b(de)f(autenticaci)1609
1170 y(\264)1599 1171 y(on)266 1358 y Fm(En)25 b(primer)g(lugar)g
(con\002guramos)g(un)g(servidor)g(web)g(en)g(el)h(que)f(instalaremos)f
(nuestro)h(ser)n(-)120 1479 y(vidor)f(de)i(autenticaci)8
b(\264)-41 b(on.)24 b(Lo)g(mejor)h(es)g(redirigir)g(todas)f(las)h
(peticiones)f(que)h(reciba)g(dicho)g(ser)n(-)120 1599
y(vidor)g(web)h(a)f(la)h(URL)g(del)f Fl(AS)h Fm(y)g(utilizar)f(SSL.)h
(En)f(nuestro)g(caso)h(v)n(amos)e(a)i(utilizar)f(un)g
Fl(virtual)120 1719 y(host)h Fm(de)f(apache,)g(que)g(con\002guraremos)g
(de)f(la)h(siguiente)f(manera:)364 1948 y Fh(NameVirtualHost)48
b(192.168.84.92:80)364 2068 y(NameVirtualHost)g(192.168.84.92:443)364
2309 y(<VirtualHost)g(192.168.84.92:80>)465 2429 y(ServerName)h
Fg(www.papi.urjc.es)465 2550 y(RedirectMatch)57 b(\(.*\))953
2670 y(https://www.papi.urjc.es/cgi)o(-bin)o(/Auth)o(Serv)o(er)364
2790 y Fh(</VirtualHost>)364 3031 y(<VirtualHost)48 b
(192.168.84.92:443>)465 3151 y(ServerName)h Fg(www.papi.urjc.es)465
3272 y(ErrorDocument)57 b(404)953 3392 y(https://www.papi.urjc.es/cgi)o
(-bin)o(/Auth)o(Serv)o(er)465 3513 y(RedirectMatch)g(/index.html)953
3633 y(https://www.papi.urjc.es/cgi)o(-bin)o(/Auth)o(Serv)o(er)465
3753 y Fh(<IfModule)50 b(mod)p 1133 3753 30 4 v 35 w(ssl.c>)567
3874 y(SSLEngine)f(on)567 3994 y(SSLCertificateFile)e
(/etc/apache/ssl.crt/server.crt)567 4115 y(SSLCertificateKeyFile)g
(/etc/apache/ssl.key/server.key)567 4235 y(SetEnvIf)i(User-Agent)g
(".*MSIE.*")g(nokeepalive)g(ssl-unclean-shutdown)465
4355 y(</IfModule>)364 4476 y(</VirtualHost>)120 4704
y Fm(Descar)n(gamos)25 b(y)g(descomprimimos)d(el)j(c)8
b(\264)-41 b(odigo)25 b(fuente)g(de)g(la)34 b(\264)-42
b(ultima)24 b(v)o(ersi)8 b(\264)-41 b(on)24 b(del)h(servidor)g(de)120
4824 y(autenticaci)8 b(\264)-41 b(on:)364 5053 y Fh(#)50
b(cd)h(/root)364 5173 y(#)f(wget)h(ftp://ftp.rediris.es/rediris/pap)o
(i/PAP)o(I-AS.1)o(.4.0.)o(tar.g)o(z)364 5293 y(#)f(tar)h(xzvf)f
(PAPI-AS.1.4.0.tar.gz)364 5414 y(#)g(cd)h(PAPI-1.4.0)p
eop end
%%Page: 4 4
TeXDict begin 4 3 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(4)120 407 y(Procedemos)28
b(a)h(compilar)f(e)h(instalar)e(el)i(servidor)-5 b(.)27
b(Antes)h(de)h(nada)f(debemos)g(ase)o(gurarnos)g(de)120
527 y(que)d(tenemos)f(los)g(siguientes)f(prerrequisitos)h(\(e)h
(instalarlos)f(si)g(no)h(cumplimos)d(alguno\):)191 756
y(1.)98 b(Perl)25 b Ff(>)p Fm(=)g(5.6)191 959 y(2.)98
b(openssl)24 b Ff(>)p Fm(=)h(0.9.5)f(\(recomendado)h(openssl)e
Ff(>)p Fm(=)i(0.9.6g\))191 1162 y(3.)98 b(Perl)25 b(Con)l(v)o
(ert::ASN1)191 1366 y(4.)98 b(Perl)25 b(DB)p 693 1366
30 4 v 37 w(File)191 1569 y(5.)98 b(Perl)25 b(Digest::MD5)191
1773 y(6.)98 b(Perl)25 b(MIME::Base64)191 1976 y(7.)98
b(Perl)25 b(URI::Escape)191 2179 y(8.)98 b(Perl)25 b(CGI::Lite)364
2408 y Fh(#)50 b(apt-get)g(install)f(perl)h(openssl)g(libssl0.9.7)f
(libssl-dev)364 2528 y(#)h(apt)h(get)f(install)f(libconvert-asn1-perl)e
(liburi-perl)364 2648 y(#)j(apt)h(get)f(install)f(libmd5-perl)g
(libmime-perl)g(libdb-file-lock-perl)364 2769 y(#)h(cd)h
Fg(/usr/share/perl/5.8.4/CGI/)364 2889 y Fh(#)f Fg(wget)59
b(http://search.cpan.org/src/SMYL)o(ERS/C)o(GI-L)o(ite-2)o(.02/)o(Lite)
o(.pm)364 3010 y Fh(#)50 b(cd)h Fg(/root/PAPI-1.4.0/)364
3130 y Fh(#)f(perl)h(Makefile.PL)364 3250 y Fe(You)59
b(must)g(provide)f(a)i(location)e(for)h(installing)e(the)i(PAPI)364
3371 y(Authentication)e(Server)h(software.)g(It)h(must)g(be)g(a)h
(directory)364 3491 y(configured)d(to)j(hold)f(CGI)g(programs)f(in)h
(your)g(Apache)364 3611 y(installation)e([/usr/local/apache/cgi-bin])
364 3732 y Fg(/usr/lib/cgi-bin)364 3852 y Fe(The)i(Authentication)e
(Server)h(CGI)h(will)g(be)g(in)364 3973 y(/usr/lib/cgi-bin/AuthServer)
364 4093 y(The)g(configuration)e(file)i(will)g(be)g
(/usr/lib/cgi-bin/AuthServer.c)o(f)364 4213 y(Other)g(data)f(files)h
(will)g(be)g(installed)f(under)h(/usr/lib/cgi-bin/etc/)364
4334 y Fh([...])364 4454 y Fe(The)g(program)f(was)h(not)g(able)g(to)h
(determine)d(a)j(location)e(for)h(your)364 4575 y(OpenSSL)f
(installation,)f(required)h(to)h(build)g(PAPI.)g(Please)f(type)h(the)
364 4695 y(full)g(path)g(to)g(the)g(OpenSSL)f(directory)g
([/usr/local/ssl])364 4815 y Fg(/usr/lib/ssl)364 4936
y Fh([...])364 5056 y(#)50 b(make)364 5176 y(#)g(make)h(install)364
5297 y(#)f(mkdir)g(-p)h(/usr/local/PAPI/AS)364 5417 y(#)f(cp)h(-r)f
(AS/etc)g(/usr/local/PAPI/AS/)p eop end
%%Page: 5 5
TeXDict begin 5 4 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(5)120 407 y(Una)32 b(v)o(ez)g(hecho)h
(esto)f(tendremos)f(instalado)g(el)h(servidor)g(de)h(autenticaci)8
b(\264)-41 b(on)31 b(en)h Fl(/usr/lib/cgi-)120 527 y(bin/A)n(uthServer)
c Fm(y)g(su)g(\002chero)g(de)g(con\002guraci)8 b(\264)-41
b(on)28 b(en)g Fl(/usr/lib/cgi-bin/A)n(uthServer)-11
b(.cf)p Fm(.)23 b(Proce-)120 648 y(demos)h(por)h(tanto)f(a)h
(con\002gurarlo:)364 876 y Fh(#)50 b(This)h(is)f(the)g(PAPI)g(AS)h
(configuration)d(file,)i(a)g(Perl)h(source)364 996 y(#)f(file)h(that)f
(essentially)e(contains)i(asignments)e(to)j(a)g(hash)f(named)364
1117 y(#)g(PAPI::AuthServer::cfgVar.)364 1357 y(use)g(LWP::UserAgent;)
364 1598 y(#)g(Include)g(here)g(the)g(modules)g(referenced)f(by)h(the)g
(elements)364 1719 y(#)g(inside)g(the)g(configuration)364
1839 y(#use)g(PAPI::BasicAuth;)364 1959 y(#use)g(PAPI::POPAuth;)364
2080 y(#use)g(PAPI::IMAPAuth;)364 2200 y Fg(use)59 b(PAPI::LDAPAuth;)
364 2320 y Fh(#use)50 b(PAPI::CertAuth;)364 2561 y(#)g(Just)h
(convenience)364 2682 y(#)364 2802 y($cfg)f(=)h Fd(n)16
b Fh(\045PAPI::AuthServer::cfgVar;)364 3043 y(#)50 b(The)h(definition)e
(of)h(the)g(working)g(directory)f(should)h(be)g(the)g(first)364
3163 y(#)g(configuration)f(assignment)364 3284 y(#)364
3404 y($$cfg)p Fd(f)p Fh(workingDirectory)p Fd(g)d Fh(=)51
b(')p Fg(/usr/local/PAPI/AS/etc)p Fh(';)364 3645 y(#)f(This)h(variable)
e(will)h(allow)g(the)g(selection)f(of)h(the)h(authentication)d(methods)
364 3765 y(#)364 3885 y(#)i(Uncomment)g(for)g(using)g(basic)g(PAPI)g
(authentication)364 4006 y(#my)g($authType)f(=)i("basic";)364
4126 y(#)f(Uncomment)g(for)g(using)g(POP-based)f(authentication)364
4247 y(#my)h($authType)f(=)i("pop";)364 4367 y(#)f(Uncomment)g(for)g
(using)g(IMAP-based)f(authentication)364 4487 y(#my)h($authType)f(=)i
("imap";)364 4608 y(#)f(Uncomment)g(for)g(using)g(LDAP-based)f
(authentication)364 4728 y Fg(my)59 b($authType)f(=)i("ldap";)364
4848 y Fh(#)50 b(Uncomment)g(for)g(using)g(X509)g(certificate)e
(authentication)364 4969 y(#my)i($authType)f(=)i("cert";)364
5210 y(#)f(Admin)g(data)g(\(included)f(in)i(the)f(HTML)g(templates\))
364 5330 y(#)364 5450 y($$cfg)p Fd(f)p Fh(adminContact)p
Fd(g)d Fh(=)k('<b>)p Fg(papi@urjc.es)p Fh(</b>';)p eop
end
%%Page: 6 6
TeXDict begin 6 5 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(6)364 527 y Fh(#)50 b(HTML)h(templates)
364 648 y(#)364 768 y($$cfg)p Fd(f)p Fh(loginTemplate)p
Fd(g)c Fh(=)j(fromFile\("login.html"\);)364 888 y($$cfg)p
Fd(f)p Fh(acceptTemplate)p Fd(g)d Fh(=)j(fromFile\("accept.html"\);)364
1009 y($$cfg)p Fd(f)p Fh(testTemplate)p Fd(g)d Fh(=)k
(fromFile\("test.html"\);)364 1129 y($$cfg)p Fd(f)p Fh(logoutTemplate)p
Fd(g)c Fh(=)j(fromFile\("logout.html"\);)364 1249 y($$cfg)p
Fd(f)p Fh(rejectTemplate)p Fd(g)d Fh(=)j(fromFile\("reject.html"\);)364
1370 y($$cfg)p Fd(f)p Fh(siteInfoTemplate)p Fd(g)c Fh(=)364
1490 y('<tr>)465 1611 y(<td>*</td>)465 1731 y(<td><a)k(href=")p
Fg(<papi)58 b(var="poa"/><papi)e(var="location"/>)618
1851 y(<papi)j(var="accessURI"/>)p Fh(")669 1972 y(target=")p
Fg(<papi)e(var="service"/>)p Fh(">)516 2092 y(<strong>)p
Fg(<papi)g(var="desc"/>)p Fh(</strong></a>)465 2213 y(</td>)415
2333 y(</tr>';)364 2574 y(#)50 b(Properties)f(of)i(this)f(AS,)g(to)h
(be)f(sent)g(to)g(the)h(PoA\(s\))364 2694 y(#)364 2814
y($$cfg)p Fd(f)p Fh(asLocation)p Fd(g)c Fh(=)k(')p Fg
(https://www.papi.urjc.es/cgi-)o(bin/)o(AuthS)o(erve)o(r)p
Fh(';)364 2935 y($$cfg)p Fd(f)p Fh(serverID)p Fd(g)d
Fh(=)i(')p Fg(URJCAS)p Fh(';)364 3055 y($$cfg)p Fd(f)p
Fh(privateKey)p Fd(g)d Fh(=)k('privkey.pem';)364 3176
y($$cfg)p Fd(f)p Fh(publicKey)p Fd(g)d Fh(=)i('pubkey.pem';)364
3416 y(#)g(Comment)g(these)g(if)g(you)g(do)h(not)f(require)g(split)f
(\(thus)h(SSL-capable\))f(mode)364 3537 y(#)364 3657
y(#$$cfg)p Fd(f)p Fh(splitModeURL)p Fd(g)e Fh(=)j('';)364
3778 y(#$$cfg)p Fd(f)p Fh(splitModeParamList)p Fd(g)c
Fh(=)k('';)364 3898 y(#)364 4018 y(#)g(These)g(parameters)f(make)h
(PoAs)g(redirect)g(accept/reject)e(responses)h(to)364
4139 y(#)h(locally)g(controlled)f(URLs)364 4259 y(#)364
4379 y(#$$cfg)p Fd(f)p Fh(acceptURL)p Fd(g)e Fh(=)k
('http://www.papi.urjc.es/accept-fil)o(e';)364 4500 y(#$$cfg)p
Fd(f)p Fh(rejectURL)p Fd(g)c Fh(=)k
('http://www.papi.urjc.es/reject-fil)o(e';)364 4620 y(#)364
4741 y(#)f(Values)g(for)g(the)h(authentication)d(cookie)364
4861 y(#)i(Comment)g(them)g(if)g(you)h(do)f(not)g(require)g(its)g(use)
364 4981 y(#)364 5102 y($$cfg)p Fd(f)p Fh(authCookie)p
Fd(g)d Fh(=)k(')p Fg(PAPIuid,username,password)p Fh(';)364
5222 y($$cfg)p Fd(f)p Fh(authCookieDB)p Fd(g)c Fh(=)974
5342 y(')p Fg(/usr/local/PAPI/AS/etc/PAPI)o(Auth)o(enCoo)o(kies)o
Fh(';)364 5463 y($$cfg)p Fd(f)p Fh(authCookieTimeToLive)p
Fd(g)f Fh(=)k Fg(7200)p Fh(;)p eop end
%%Page: 7 7
TeXDict begin 7 6 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(7)364 407 y Fh(#)364 527
y(#)50 b(Value)g(of)h(the)f(AS)g(symmetric)g(key)364
648 y(#)g(Used)h(in)f(split)g(mode)g(and)g(for)g(en-/de-crypting)e(the)
j(authentication)d(cookie)364 768 y(#)i(It)h(is)f(highly)g(advisable)f
(that)h(you)g(change)g(this)g(value)364 888 y(#)364 1009
y(#$$cfg)p Fd(f)p Fh(symKey)p Fd(g)e Fh(=)j
('ca1813914a25b12a14ca121516e26180)o(';)364 1129 y(#)364
1249 y(#)f(The)h(connection)e(variable)g(holding)g(user)h(id)h(\(for)f
(TEST)g(and)g(LOGOUT\))364 1370 y($$cfg)p Fd(f)p Fh(uidVar)p
Fd(g)e Fh(=)j(')p Fg(username)p Fh(';)364 1611 y(#)f(Default)g(values)g
(for)g(the)g(PoA\(s\))364 1731 y(#)364 1851 y($$cfg)p
Fd(f)p Fh(defTimeToLive)p Fd(g)d Fh(=)j Fg(7200)p Fh(;)364
1972 y($$cfg)p Fd(f)p Fh(defLocation)p Fd(g)d Fh(=)k('/';)364
2092 y($$cfg)p Fd(f)p Fh(defService)p Fd(g)p Fh(=)c('';)364
2213 y($$cfg)p Fd(f)p Fh(defPoA)p Fd(g)h Fh(=)j('';)364
2333 y($$cfg)p Fd(f)p Fh(defDescription)p Fd(g)c Fh(=)j('';)364
2453 y($$cfg)p Fd(f)p Fh(defAuthURI)p Fd(g)d Fh(=)k('/cookie)p
1792 2453 30 4 v 34 w(handler.cgi';)364 2574 y($$cfg)p
Fd(f)p Fh(defAccessURI)p Fd(g)c Fh(=)k('';)364 2694 y(#)364
2814 y(#)f(Default)g(assertion)f(about)h(users)g(to)g(be)h(sent)f(to)g
(PoA\(s\))364 2935 y Fg($$cfg)p Fd(f)p Fg(defAssertion)p
Fd(g)55 b Fg(=)60 b('';)364 3176 y Fh(#)50 b(Hooks)g(and)h(hook)f
(config.)f(By)i(default,)e("basic")g(authentication)f(is)j(used)364
3296 y(#)364 3416 y(if)f(\($authType)f(eq)i("pop"\))e
Fd(f)364 3537 y Fe([...])364 3657 y Fh(elsif)h(\($authType)f(eq)h
("imap"\))g Fd(f)364 3778 y Fe([...])364 3898 y Fh(elsif)g(\($authType)
f(eq)h(")p Fg(ldap)p Fh("\))f Fd(f)516 4018 y Fh($$cfg)p
Fd(f)p Fh(authenticationHook)p Fd(g)d Fh(=)51 b Fd(n)p
Fh(&PAPI::LDAPAuth::VerifyUser;)516 4139 y($$cfg)p Fd(f)p
Fh(credentialHook)p Fd(g)c Fh(=)k Fd(n)p Fh
(&PAPI::LDAPAuth::UserCredentials)o(;)516 4259 y($$cfg)p
Fd(f)p Fh(attrRequestHook)p Fd(g)c Fh(=)k Fd(n)p Fh
(&PAPI::LDAPAuth::UserAttributes)o(;)516 4379 y($$cfg)p
Fd(f)p Fh(LDAPserver)p Fd(g)d Fh(=)i(")p Fg(dagobah.urjc.es)p
Fh(";)516 4500 y($$cfg)p Fd(f)p Fh(LDAPport)p Fd(g)e
Fh(=)j(389;)516 4620 y($$cfg)p Fd(f)p Fh(LDAPUSERtemplate)p
Fd(g)c Fh(=)j(')p Fg(uid=<papi)58 b(var="username"/>)p
Fh(';)516 4741 y($$cfg)p Fd(f)p Fh(LDAPAuthSearchBase)p
Fd(g)46 b Fh(=)51 b(')p Fg(ou=gente,dc=urjc,dc=es)p Fh(';)516
4861 y($$cfg)p Fd(f)p Fh(LDAPAuthScope)p Fd(g)c Fh(=)k('sub';)516
4981 y($$cfg)p Fd(f)p Fh(LDAPsearchBase)p Fd(g)c Fh(=)k(')p
Fg(ou=papiSite,dc=urjc,dc=es)p Fh(';)364 5102 y(#)f(Uncomment)g(these)f
(to)i(use)f(simple)g(authentication)e(when)i(binding)364
5222 y(#)g(to)h(the)f(LDAP)g(server)516 5342 y($$cfg)p
Fd(f)p Fh(LDAPbindDN)p Fd(g)e Fh(=)821 5463 y(')p Fg
(uid=managerid,ou=admin,dc=urj)o(c,dc=)o(es)p Fh(';)p
eop end
%%Page: 8 8
TeXDict begin 8 7 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(8)516 407 y Fh($$cfg)p
Fd(f)p Fh(LDAPbindPassword)p Fd(g)47 b Fh(=)j(')p Fg(contrase)2366
405 y(\230)2366 407 y(na)p Fh(';)364 527 y(#)g(Uncomment)g(these)f(to)i
(use)f(a)h(TLS)f(connection)f(and)h(verify)g(server)f(identity)364
648 y(#)152 b($$cfg)p Fd(f)p Fh(LDAPS)p Fd(g)49 b Fh(=)h(1;)364
768 y(#)152 b($$cfg)p Fd(f)p Fh(LDAPSverify)p Fd(g)47
b Fh(=)k('require';)364 888 y(#)152 b($$cfg)p Fd(f)p
Fh(LDAPScafile)p Fd(g)47 b Fh(=)k('/etc/PAPI/CAs/MyRoot.pem';)364
1009 y Fd(g)364 1129 y Fh(elsif)f(\($authType)f(eq)h("cert"\))g
Fd(f)364 1249 y Fe([...])364 1370 y Fh(else)g Fd(f)364
1490 y Fe([...])364 1611 y Fh($$cfg)p Fd(f)p Fh(logHook)p
Fd(g)e Fh(=)j(undef;)364 1851 y Fe([...])120 2036 y Fm(Una)21
b(v)o(ez)g(con\002gurado)g(el)g(servidor)f(de)h(autenticaci)8
b(\264)-41 b(on,)20 b(generamos)h(su)f(par)h(de)g(cla)n(v)o(es)g(asim)6
b(\264)-39 b(etri-)120 2156 y(cas)28 b Fl(/usr/local/P)-9
b(API/AS/etc/pubk)o(e)m(y)k(.pem)24 b Fm(y)k Fl(/usr/local/P)-9
b(API/AS/etc/privk)o(e)m(y)k(.pem)p Fm(,)24 b(referen-)120
2276 y(ciadas)h(en)g(la)g(con\002guraci)8 b(\264)-41
b(on:)364 2460 y Fh(#)50 b(cd)h(/usr/local/PAPI/AS/etc)364
2581 y(#)f(openssl)g(genrsa)g(1024)g(-out)g(privkey.pem)364
2701 y(#)g(openssl)g(rsa)g(-in)g(privkey.pem)f(-pubout)h(-out)g
(pubkey.pem)120 2885 y Fm(Editamos)41 b(adem)6 b(\264)-39
b(as)43 b(las)g(plantillas)e(HTML)i(indicadas)f(en)h(la)g
(con\002guraci)8 b(\264)-41 b(on,)43 b(para)g(que)g(se)120
3006 y(adec)8 b(\264)-41 b(uen)25 b(a)f(nuestras)g(necesidades,)g(en)h
(el)f(directorio)g Fl(/usr/local/P)-9 b(API/AS/etc)p
Fm(.)21 b(Podemos)i(mo-)120 3126 y(di\002car)i(las)g(plantillas)e(de)i
(ejemplo:)p 273 3301 32 32 v 364 3310 a Fl(accept.html)p
273 3494 V 364 3503 a(lo)o(gin.html)p 273 3686 V 364
3695 a(lo)o(gout.html)p 273 3878 V 364 3887 a(r)l(eject.html)p
273 4071 V 364 4080 a(test.html)120 4264 y Fm(Hecho)34
b(esto)f(disponemos)e(de)j(nuestro)f(servidor)g(de)g(autenticaci)8
b(\264)-41 b(on)33 b(con\002gurado,)h(a)f(f)o(alta)h(de)120
4384 y(incluir)24 b(puntos)g(de)h(acceso)g(y)g(su)f(con\002guraci)8
b(\264)-41 b(on)25 b(asociada.)120 4673 y Fj(2.2.)119
b(Puntos)30 b(de)g(acceso)f(con)-5 b(v)o(encionales)266
4861 y Fm(La)38 b(con\002guraci)8 b(\264)-41 b(on)36
b(aqu)m(\264)-30 b(\021)37 b(se)o(guida)f(implica)g(que)h(tanto)f(el)h
Fl(AS)h Fm(como)e(los)h Fl(P)-8 b(oAs)36 b Fm(perl)h(que)120
4981 y(act)8 b(\264)-41 b(uan)32 b(en)g(modo)f(proxy)h(se)g(instalan)f
(en)i(el)f(mismo)e(servidor)l(,)i(al)g(igual)f(que)h(los)f
Fl(GP)-8 b(oAs)p Fm(.)32 b(De)120 5102 y(este)37 b(modo,)e(nuestros)h
Fl(P)-8 b(oAs)36 b Fm(ser)6 b(\264)-39 b(an)37 b Fl(hosts)f(virtuales)f
Fm(del)i(servidor)-5 b(.)36 b(Lo)g(mejor)g(en)h(este)g(caso)120
5222 y(es)25 b(crear)i(un)e(archi)n(v)n(o)g(separado)h(de)f
(con\002guraci)8 b(\264)-41 b(on)25 b(para)h(los)f(puntos)f(de)i
(acceso,)g(por)f(ejemplo,)120 5342 y Fl(/etc/apac)o(he/conf)o(.d/papi)p
Fm(.)16 b(Dicho)k(\002chero)g(debe)g(ir)g(encabezado)h(por)f(la)g
(con\002guraci)8 b(\264)-41 b(on)20 b(general)120 5463
y(de)25 b(P)-9 b(API)26 b(para)f(sus)f(puntos)g(de)h(acceso:)p
eop end
%%Page: 9 9
TeXDict begin 9 8 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1623 b Fm(9)364 407 y Fh(#)364 527
y(#)50 b(Configuraci)1026 526 y(\264)1026 527 y(on)f(general)g(de)i
(PAPI)364 648 y(#)364 768 y(PerlModule)e(PAPI::Conf)364
888 y(<PAPI)p 625 888 30 4 v 35 w(Main>)465 1009 y(Service)p
828 1009 V 35 w(ID)h(poa)p 1168 1009 V 36 w(generico)465
1129 y(HKEY)p 675 1129 V 36 w(File)g Fg(/usr/local/PAPI/PoA/hkey)465
1249 y Fh(LKEY)p 675 1249 V 36 w(File)g Fg(/usr/local/PAPI/PoA/lkey)465
1370 y Fh(Lcook)p 726 1370 V 35 w(Timeout)g Fg(86400)465
1490 y Fh(CRC)p 624 1490 V 36 w(Timeout)f Fg(1800)465
1611 y Fh(URL)p 624 1611 V 36 w(Timeout)g Fg(1800)465
1731 y Fh(Debug)h(0)465 1851 y(Auth)p 675 1851 V 36 w(Location)f
(/cookie)p 1525 1851 V 34 w(handler.cgi)364 1972 y(#)h(en)h(caso)f(de)g
(utilizar)g(el)g(mecanismo)f(de)i(las)f(``bolitas'',)364
2092 y(#)g(debemos)g(descomentar)f(las)h(siguientes)f(l)2295
2091 y(\264)2295 2092 y(\021neas)364 2213 y(#)101 b(Accept)p
828 2213 V 35 w(File)50 b(/usr/local/PAPI/PoA/yes.gif)364
2333 y(#)101 b(Reject)p 828 2333 V 35 w(File)50 b
(/usr/local/PAPI/PoA/no.gif)465 2453 y(Pubkeys)p 828
2453 V 35 w(Path)g Fg(/usr/local/PAPI/PoA/KEYS)465 2574
y Fh(Hcook)p 726 2574 V 35 w(DB)h Fg(/usr/local/PAPI/PoA/hcook.db)465
2694 y(PAPI)p 711 2694 V 35 w(AS)60 b(URJCAS)654 2814
y(https://www.papi.urjc.es/cgi-)o(bin/)o(Auth)o(Serve)o(r)54
b(AuthServer)j(URJC)364 2935 y Fh(</PAPI)p 676 2935 V
35 w(Main>)120 3147 y Fm(Descar)n(gamos)25 b(y)g(descomprimimos)d(el)j
(c)8 b(\264)-41 b(odigo)25 b(fuente)g(de)g(la)34 b(\264)-42
b(ultima)24 b(v)o(ersi)8 b(\264)-41 b(on)24 b(del)h(servidor)g(de)120
3268 y(autenticaci)8 b(\264)-41 b(on:)364 3480 y Fh(#)50
b(cd)h(/root)364 3601 y(#)f(wget)h(ftp://ftp.rediris.es/rediris/pap)o
(i/PAP)o(I-PoA.)o(1.4.0)o(.tar.)o(gz)364 3721 y(#)f(tar)h(xzvf)f
(PAPI-PoA.1.4.0.tar.gz)120 3933 y Fm(Compilamos)35 b(e)i(instalamos)e
(el)i(punto)f(de)g(acceso.)i(Nos)e(ase)o(guramos)f(de)i(que)g(tenemos)f
(los)120 4054 y(siguientes)23 b(prerrequisitos)h(\(y)h(los)f
(instalamos)f(si)i(no)f(cumplimos)f(alguno\):)191 4266
y(1.)98 b(mod)p 548 4266 V 35 w(perl)25 b Ff(>)p Fm(=)g(1.20)191
4466 y(2.)98 b(apache)25 b Ff(>)p Fm(=)g(1.3.8)191 4665
y(3.)98 b(Perl)25 b(SSL)191 4865 y(4.)98 b(Perl)25 b(MLDBM)191
5064 y(5.)98 b(Perl)25 b(MLDBM::Sync)191 5263 y(6.)98
b(Perl)25 b(URI::URL)191 5463 y(7.)98 b(Perl)25 b(HTML::T)-8
b(ok)o(eP)o(arser)p eop end
%%Page: 10 10
TeXDict begin 10 9 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(10)191 407 y(8.)98 b(Perl)25
b(HTTP:Cookies)191 610 y(9.)98 b(Perl)25 b(Data::Dumper)141
814 y(10.)98 b(Perl)25 b(HTTP::Request::F)o(orm)141 1017
y(11.)98 b(Perl)25 b(Net::LD)l(AP)364 1245 y Fh(#)50
b(apt-get)g(install)f(libapache-mod-perl)f(apache)364
1366 y(#)i(apt)h(get)f(install)f(libio-socket-ssl-perl)e(libmldbm-perl)
364 1486 y(#)j(apt)h(get)f(install)f(liburi-perl)g(libmldbm-sync-perl)
364 1606 y(#)h(apt-get)g(install)f(libhtml-tokeparser-simple-perl)364
1727 y(#)h(apt-get)g(install)f(libapache-authcookie-perl)364
1847 y(#)h(apt-get)g(install)f(libdata-dumper-simple-perl)364
1968 y(#)h(apt-get)g(install)f(libnet-ldap-perl)364 2088
y(#)h(cd)364 2208 y(#)g(wget)h Fg(http://.../HTTP-Request-For)o(m-0.9)o
(52.t)o(ar.gz)364 2329 y Fh(#)f(tar)h(xzvf)f
(HTTP-Request-Form-0.952.tar.gz)364 2449 y(#)g(cd)h Fg
(HTTP-Request-Form-0.952)364 2570 y Fh(#)f(perl)h(Makefile.PL)364
2690 y(#)f(make)364 2810 y(#)g(make)h(install)120 3039
y Fm(Una)25 b(v)o(ez)g(cumplidos)e(los)h(prerrequisitos,)f(instalamos)h
(el)g(PoA:)364 3267 y Fh(#)50 b(cd)h Fg(/root/PAPI-1.4.0)364
3387 y Fh(#)f(perl)h(Makefile.PL)364 3508 y Fe(You)59
b(must)g(provide)f(a)i(location)e(for)h(installing)e(the)i(PAPI)364
3628 y(Authentication)e(Server)h(software.)g(It)h(must)g(be)g(a)h
(directory)364 3748 y(configured)d(to)j(hold)f(CGI)g(programs)f(in)h
(your)g(Apache)364 3869 y(installation)e([/usr/local/apache/cgi-bin])
364 3989 y Fc(/usr/lib/cgi-bin)364 4110 y Fe(The)i(Authentication)e
(Server)h(CGI)h(will)g(be)g(in)364 4230 y(/usr/lib/cgi-bin/AuthServer)
364 4350 y(The)g(configuration)e(file)i(will)g(be)g
(/usr/lib/cgi-bin/AuthServer.c)o(f)364 4471 y(Other)g(data)f(files)h
(will)g(be)g(installed)f(under)h(/usr/lib/cgi-bin/etc/)364
4591 y([...])364 4711 y(The)g(program)f(was)h(not)g(able)g(to)h
(determine)d(a)j(location)e(for)h(your)364 4832 y(OpenSSL)f
(installation,)f(required)h(to)h(build)g(PAPI.)g(Please)f(type)h(the)
364 4952 y(full)g(path)g(to)g(the)g(OpenSSL)f(directory)g
([/usr/local/ssl])364 5073 y Fc(/usr/lib/ssl)364 5193
y Fe([...])364 5313 y Fh(#)50 b(make)364 5434 y(#)g(make)h(install)p
eop end
%%Page: 11 11
TeXDict begin 11 10 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(11)120 407 y(Estando)33
b(el)i(PoA)f(instalado,)f(podemos)g(incluir)h(la)g(con\002guraci)8
b(\264)-41 b(on)34 b(general)g(de)h(P)-9 b(API)35 b(ya)f(e)o(x-)120
527 y(puesta)f(en)g(la)h(con\002guraci)8 b(\264)-41 b(on)33
b(de)h(Apache,)f(y)h(proceder)g(a)f(con\002gurar)h(los)f(puntos)f(de)h
(acceso)120 648 y(que)f(necesitemos.)f(Lo)g(m)6 b(\264)-39
b(as)32 b(sencillo)e(es)i(utilizar)g Fl(virtual)e(hosts)h
Fm(para)h(cada)h(uno.)e(En)h(nuestro)120 768 y(caso,)24
b(queremos)f(que)h(los)f(accesos)h(se)g(hagan)f(siempre)g(mediante)g
(cone)o(xiones)g(se)o(guras,)g(por)g(lo)120 888 y(que)i(redirigimos)e
(todo)h(el)h(tr)6 b(\264)-39 b(a\002co)25 b(para)h(utilizar)e(SSL:)364
1117 y Fh(<VirtualHost)48 b(192.168.84.92:80>)465 1237
y(ServerName)h(poa.papi.urjc.es)465 1357 y(ErrorDocument)g(404)h
(https://poa.papi.urjc.es/index.html)364 1478 y(</VirtualHost>)364
1719 y(<VirtualHost)e(192.168.84.92:443>)465 1839 y(ServerName)h
(poa.papi.urjc.es)465 1959 y(ErrorDocument)g(403)h
(https://www.papi.urjc.es/cgi-bin/Au)o(thSer)o(ver)465
2080 y(<Location)g Fg(/app)p Fh(>)567 2200 y(PerlSendHeader)e(On)567
2320 y(PerlAccessHandler)g(PAPI::Main)567 2441 y(<PAPI)p
828 2441 30 4 v 35 w(Local>)669 2561 y(Service)p 1032
2561 V 34 w(ID)j(poa)669 2682 y(Req)p 828 2682 V 35 w(DB)f
(/usr/local/PAPI/PoA/req)p 2188 2682 V 32 w(poa)669 2802
y Fg(GPoA)p 915 2802 V 35 w(URL)59 b(wayf:built-in)567
2922 y Fh(</PAPI)p 879 2922 V 35 w(Local>)465 3043 y(</Location>)364
3163 y(</VirtualHost>)120 3391 y Fm(Este)29 b(punto)g(de)h(acceso)g
(funciona)f(de)h(la)f(forma)h(m)6 b(\264)-39 b(as)29
b(simple)f(posible,)h(en)g(nuestro)g(caso,)h(pro-)120
3512 y(te)o(giendo)i(todos)g(los)h(accesos)h(que)f(se)g(hagan)g(a)g
Fl(http://poa.papi.urjc.es/app)p Fm(.)c(Si)34 b(un)f(usuario)120
3632 y(trata)g(de)g(acceder)h(a)g(cualquier)e(URL)i(que)f(comience)f
(por)h Fl(/app)p Fm(,)f(ser)6 b(\264)-39 b(a)34 b(redireccionado)f(a)g
(una)120 3753 y(cone)o(xi)8 b(\264)-41 b(on)22 b(se)o(gura,)g(y)h(una)g
(v)o(ez)f(hecho)h(esto)g(se)g(comprobar)6 b(\264)-39
b(a)22 b(si)h(tiene)f(las)h(credenciales)g(de)g(P)-9
b(API)120 3873 y(en)27 b(orden.)g(En)g(caso)h(a\002rmati)n(v)n(o)e(se)h
(le)h(garantizar)6 b(\264)-39 b(a)27 b(acceso,)h(y)f(en)g(caso)h
(contrario)f(se)g(le)g(rediri-)120 3993 y(gir)6 b(\264)-39
b(a)28 b(al)g Fl(AS)h Fm(para)f(que)g(se)g(autentique.)f(Si)i(el)f
(acceso)g(se)g(realiza)h(a)f(otra)g(URL)h(que)f(no)f(est)6
b(\264)-39 b(a)28 b(bajo)120 4114 y(la)d(protecci)8 b(\264)-41
b(on)24 b(del)h(punto)f(de)h(acceso,)g(P)-9 b(API)26
b(no)e(interv)o(endr)6 b(\264)-39 b(a)24 b(de)h(ning)8
b(\264)-41 b(un)24 b(modo.)120 4409 y Fj(2.3.)119 b(Puntos)30
b(de)g(acceso)f(en)i(modo)e(pr)n(oxy)h(de)g(r)n(eescritura)266
4597 y Fm(Los)j(puntos)f(de)h(acceso)h(en)f(modo)f(proxy)g(se)i
(con\002guran)f(e)o(xactamente)f(igual)h(que)g(cual-)120
4717 y(quier)27 b(otro)g(punto)g(de)g(acceso,)h(con)g(la)f
(particularidad)g(de)g(que)h(debemos)e(indicar)i(la)f(URL)h(o)f(el)120
4837 y(dominio)c(al)i(que)g(redirigir)f(las)h(peticiones)f(entrantes.)g
(Por)h(ejemplo:)364 5066 y Fh(<VirtualHost)48 b(192.168.84.92:80>)465
5186 y(ServerName)h(proxy.papi.urjc.es)465 5306 y(RedirectMatch)g
(/index.html)g(https://proxy.papi.urjc.es)465 5427 y(ErrorDocument)g
(404)h(https://proxy.papi.urjc.es/index.ht)o(ml)p eop
end
%%Page: 12 12
TeXDict begin 12 11 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(12)364 407 y Fh(</VirtualHost>)364
648 y(<VirtualHost)48 b(192.168.84.92:443>)465 768 y(ServerName)h
(proxy.papi.urjc.es)465 888 y(ErrorDocument)g(403)h
(https://www.papi.urjc.es/cgi-bin/Au)o(thSer)o(ver)465
1009 y(<Location)g(/>)567 1129 y(PerlSendHeader)e(On)567
1249 y(PerlAccessHandler)g(PAPI::Main)567 1370 y(<PAPI)p
828 1370 30 4 v 35 w(Local>)669 1490 y(Service)p 1032
1490 V 34 w(ID)j(proxy)669 1611 y(Req)p 828 1611 V 35
w(DB)f(/usr/local/PAPI/PoA/req)p 2188 1611 V 32 w(proxy)669
1731 y(GPoA)p 879 1731 V 35 w(URL)g(wayf:built-in)669
1851 y Fg(Remote)p 1035 1851 V 34 w(URL)59 b(http://www.urjc.es)669
1972 y(Eval)p 915 1972 V 35 w(Proxy)p 1250 1972 V 34
w(Redirects)f(1)567 2092 y Fh(</PAPI)p 879 2092 V 35
w(Local>)465 2213 y(</Location>)364 2333 y(</VirtualHost>)120
2561 y Fm(De)23 b(esta)g(forma)g(el)g(punto)f(de)i(acceso)f(en)g(v)o
(ez)g(de)h(prote)o(ger)e(una)h(localizaci)8 b(\264)-41
b(on)23 b(concreta)g(del)g(pro-)120 2682 y(pio)f(servidor)l(,)g(lo)g
(hace)h(respecto)g(a)g(una)f(URL)h(e)o(xterna)f(comport)6
b(\264)-39 b(andose)22 b(como)g(un)g(proxy)-6 b(.)21
b(Si)i(en)120 2802 y(v)o(ez)g(de)h(utilizar)f(la)g(directi)n(v)n(a)f
Fb(Remote)p 1498 2802 V 37 w(URL)h Fm(utilizamos)f Fb(Remote)p
2533 2802 V 36 w(Domain)h Fm(acompa)8 b(\230)-41 b(nada)24
b(de)120 2922 y(un)19 b(nombre)f(de)h(dominio,)e(todas)h(las)h
(peticiones)f(recibidas)g(de)h(la)g(forma)g Fl(http://pr)l(oxy)-5
b(.papi.urjc.es)120 3043 y(/host/pa)o(gina)28 b Fm(se)i(traducir)6
b(\264)-39 b(an)30 b(en)h(peticiones)e(a)h Fl(http://host.dominio/pa)o
(gina)p Fm(.)25 b(P)o(ara)31 b(conse)o(guir)120 3163
y(esto)g(es)g(con)l(v)o(eniente)f(usar)h(tambi)6 b(\264)-39
b(en)31 b(la)g(directi)n(v)n(a)f Fb(Strip)p 2182 3163
V 36 w(Location)i Fm(con)f(el)g(v)n(alor)g Fl(1)p Fm(.)g(De)g(este)120
3284 y(modo)23 b(las)h(peticiones)f Fl(/host/pa)o(gina)e
Fm(se)k(traducen)f(en)g Fl(/pa)o(gina)f Fm(en)h(la)g(URL)g(remota)g
(especi\002ca-)120 3404 y(da)h(con)g Fb(Remote)p 740
3404 V 36 w(URL)p Fm(.)266 3524 y(Por)40 b(\264)-41 b(ultimo,)30
b(podemos)g(utilizar)h(las)g(directi)n(v)n(as)f Fb(P)-7
b(API)p 2246 3524 V 35 w(Redir)n(ect)p Fm(,)32 b Fb(Rewrite)p
3037 3524 V 37 w(URL)f Fm(y)h Fb(Re-)120 3645 y(dir)n(ect)p
372 3645 V 37 w(All)26 b Fm(para)g(de\002nir)h(las)f(sustituciones)e
(de)i(URLs)h(en)f(los)g(documentos)e(HTML)i(servidos,)120
3765 y(hacerlo)i(incluso)e(en)i(contenidos)e(no)h(HTML)g(\(como)g(c)8
b(\264)-41 b(odigo)27 b(ja)n(v)n(ascript\))f(y)i(e)n(v)n(aluar)e(todas)
h(las)120 3885 y(URLs)c(encontradas)f(en)h(el)g(documento)e(en)i(modo)e
(agresi)n(v)n(o,)h(respecti)n(v)n(amente.)f(P)o(ara)i(informa-)120
4006 y(ci)8 b(\264)-41 b(on)24 b(detallada)g(sobre)h(todas)f(estas)g(y)
h(otras)f(directi)n(v)n(as)f(adicionales)h(es)g(con)l(v)o(eniente)g
(consultar)120 4126 y(la)h(gu)m(\264)-30 b(\021a)24 b(para)i
(principiantes)d(de)i(P)-9 b(API.)120 4421 y Fj(2.4.)119
b(A)-6 b(utocompletado)30 b(de)h(f)m(ormularios)266 4609
y Fm(El)21 b(autocompletado)e(de)i(formularios)f(es)h(una)g(vuelta)g
(de)g(tuerca)g(sobre)g(la)g(con\002guraci)8 b(\264)-41
b(on)21 b(de)120 4729 y(un)29 b Fl(P)-8 b(oA)29 b Fm(en)h(modo)e(proxy)
-6 b(.)28 b(B)6 b(\264)-39 b(asicamente)30 b(consiste)e(en)i(utilizar)e
(la)i(directi)n(v)n(a)e(From)p 3123 4729 V 36 w(Processor)120
4850 y(para)d(con\002gurar)h(el)f(m)8 b(\264)-41 b(odulo)23
b(de)i(P)-9 b(API)26 b(que)e(se)h(encar)n(gar)6 b(\264)-39
b(a)26 b(de)f(los)f(formularios.)g(Por)h(ejemplo:)364
5078 y Fh(<VirtualHost)48 b(192.168.84.92:80>)465 5198
y(ServerName)h(proxy.papi.urjc.es)465 5319 y(RedirectMatch)g(\(.*\))h
(https://proxy.papi.urjc.es/)364 5439 y(</VirtualHost>)p
eop end
%%Page: 13 13
TeXDict begin 13 12 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(13)364 527 y Fh(<VirtualHost)48
b(192.168.84.92:443>)465 648 y(ServerName)h(proxy.papi.urjc.es)465
768 y(<Location)h(/>)567 888 y(PerlSendHeader)e(On)567
1009 y(PerlAccessHandler)g(PAPI::Main)567 1129 y(<PAPI)p
828 1129 30 4 v 35 w(Local>)669 1249 y(Service)p 1032
1249 V 34 w(ID)j(proxy)669 1370 y(Req)p 828 1370 V 35
w(DB)f(/usr/local/PAPI/PoA/req)p 2188 1370 V 32 w(proxy)669
1490 y(GPoA)p 879 1490 V 35 w(URL)g(wayf:built-in)669
1611 y(Remote)p 981 1611 V 34 w(URL)h(https://www.urjc.es)669
1731 y(Redirect)p 1083 1731 V 34 w(All)f(1)669 1851 y(PAPI)p
879 1851 V 35 w(Redirect)f(www.urjc.es\(.*?\))f(proxy.papi.urjc.es$1)
669 1972 y Fg(Eval)p 915 1972 V 35 w(Proxy)p 1250 1972
V 34 w(Redirects)58 b(1)714 2092 y(Form)p 960 2092 V
35 w(Processor)f(urle=>\210/.*)h Fd(n)833 2213 y Fg(form=>login)f
(buttonName=>action)p 2636 2213 V 32 w(login)i Fd(n)833
2333 y Fg(field=>\(password,$r->notes\('PA)o(PIAt)o(tr-pa)o(sswo)o
(rd'\)\))53 b Fd(n)833 2453 y Fg(field=>\(usuario,$r->notes\('PAP)o
(IAtt)o(r-use)o(rnam)o(e'\)\))567 2574 y Fh(</PAPI)p
879 2574 V 35 w(Local>)465 2694 y(</Location>)120 2922
y Fm(La)25 b(directi)n(v)n(a)f Fb(F)n(orm)p 861 2922
V 35 w(Pr)n(ocessor)h Fm(se)g(compone)f(de)h(los)f(siguientes)f(atrib)n
(utos:)p 273 3142 32 32 v 364 3151 a Fl(urle)p Fm(:)29
b(una)g(e)o(xpresi)8 b(\264)-41 b(on)28 b(re)o(gular)h(que)h(de\002ne)g
(la)f(URL)h(o)f(URLs)g(en)h(las)f(que)g(se)h(encuentra)364
3271 y(el)25 b(formulario)f(que)g(queremos)h(completar)f(autom)6
b(\264)-39 b(aticamente.)p 273 3465 V 364 3474 a Fl(form)p
Fm(:)22 b(el)i(nombre)f(del)g(formulario,)f(en)i(caso)f(de)h(que)f
(haya)h(m)6 b(\264)-39 b(as)23 b(de)g(uno.)g(Si)h(no)f(se)h(indica)364
3595 y(este)g(atrib)n(uto)g(o)g(no)g(e)o(xiste)f(ning)8
b(\264)-41 b(un)23 b(formulario)h(con)g(el)g(nombre)g(indicado,)g(se)g
(ele)o(gir)6 b(\264)-39 b(a)24 b(el)364 3715 y(primer)g(formulario)g
(de)h(la)g(p)6 b(\264)-39 b(agina.)p 273 3910 V 364 3919
a Fl(b)n(uttonName)p Fm(:)24 b(el)g(nombre)h(del)f(bot)8
b(\264)-41 b(on)24 b(de)h(en)l(v)m(\264)-30 b(\021o)24
b(del)h(formulario.)p 273 4113 V 364 4122 a Fl(\002eld)s
Fm(:)32 b(un)g(campo)g(del)h(formulario,)f(de\002nido)g(por)h(una)f
(tupla)g(\()p Fl(nombr)l(e)p Fm(,)h Fl(valor)r Fm(\),)g(donde)364
4242 y Fl(nombr)l(e)j Fm(es)g(el)g(nombre)f(del)h(campo)f(en)h(el)g
(formulario)g(y)f Fl(valor)j Fm(el)e(v)n(alor)f(con)h(el)g(que)364
4363 y(queremos)h(rellenarlo.)g(Incluiremos)g(este)g(atrib)n(uto)g
(tantas)g(v)o(eces)g(como)g(campos)g(ne-)364 4483 y(cesitemos)29
b(en)l(viar)l(,)i(incluyendo)e(aquellos)h(ocultos.)f(Podemos)h
(utilizar)g(v)n(alores)g(\002jos)g(o)364 4604 y(incluso)f(v)n(ariables)
h(de)g(P)-9 b(API)32 b(para)e(rellenar)h(un)f(campo)g(con,)h(por)f
(ejemplo,)f(el)i(nombre)364 4724 y(de)38 b(usuario)e(o)i(la)f(contrase)
8 b(\230)-41 b(na)38 b(del)f(mismo.)f(P)o(ara)i(esto)f(debemos)g(acti)n
(v)n(ar)g(la)g(directi)n(v)n(a)364 4844 y Fb(Ev)o(al)p
563 4844 30 4 v 36 w(Pr)n(oxy)p 852 4844 V 35 w(Redir)n(ects)p
Fm(,)h(que)e(permite)g(que)g(Perl)h(e)n(v)n(al)8 b(\264)-41
b(ue)35 b(los)h(v)n(alores)g(especi\002cados)364 4965
y(en)d(la)g(con\002guraci)8 b(\264)-41 b(on.)33 b(De)h(esta)f(forma,)g
(cuando)g(queramos)f(obtener)h(un)g(campo)g(de)g(la)364
5085 y(aserci)8 b(\264)-41 b(on)25 b(de)g(P)-9 b(API)25
b(utilizaremos)e(la)i(sintaxis)e Fk($)p Fl(r)n(-)p Ff(>)p
Fl(notes\('P)-9 b(APIAttr)n(-nombr)l(e'\))p Fm(,)24 b(donde)364
5205 y Fl(nombr)l(e)j Fm(es)g(el)g(nombre)f(del)h(campo)g(en)g(la)g
(propia)f(aserci)8 b(\264)-41 b(on.)27 b(Esto)f(implica)g(que)h(pre)n
(via-)364 5326 y(mente)22 b(debemos)h(modi\002car)g(el)f(formato)h(de)g
(la)g(aserci)8 b(\264)-41 b(on)23 b(de)g(la)g(siguiente)f(forma:)h
Fl(varia-)364 5446 y(ble1=valor1,variable2=valor2)p Fm(.)j(Esto)j(lo)g
(haremos)g(en)g(la)h(propia)f(con\002guraci)8 b(\264)-41
b(on)29 b(del)p eop end
%%Page: 14 14
TeXDict begin 14 13 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(14)364 407 y(punto)29
b(de)i(acceso)g(en)f(el)h(atrib)n(uto)e Fl(papiAssertion)f
Fm(del)i(LD)l(AP)-11 b(.)31 b(Por)f(ejemplo,)g(si)g(quere-)364
527 y(mos)j(que)h(la)g(aserci)8 b(\264)-41 b(on)34 b(del)g(PoA)g(sea)g
Fl(usuario=valor)-11 b(,passwor)l(d=valor)p Fm(,)31 b(con\002gurare-)
364 648 y(mos)21 b Fl(papiAssertion)e Fm(de)j(la)g(siguiente)f(forma:)h
Fl(usuario=)p Ff(<)p Fl(papi)d(attr=\224lo)o(gin\224/)p
Ff(>)p Fl(,)i(pass-)364 768 y(wor)l(d=)p Ff(<)p Fl(papi)29
b(var=\224passwor)l(d\224/)p Ff(>)p Fm(,)h(donde)f Fl(attr)j
Fm(especi\002ca)e(que)g(\223)p Fl(lo)o(gin)p Fm(\224)f(es)h(un)g(atri-)
364 888 y(b)n(uto)22 b(localizado)h(en)g(el)g(per\002l)g(del)g(usuario)
f(en)h(el)g(LD)l(AP)-11 b(,)23 b(y)g Fl(var)i Fm(indica)e(que)g(\223)p
Fl(passwor)l(d)s Fm(\224)364 1009 y(es)g(una)g(v)n(ariable)g(del)g
(formulario)g(de)g(autenticaci)8 b(\264)-41 b(on)22 b(del)h(AS)h(\(y)f
(que)h(deber)6 b(\264)-39 b(a)23 b(propagarse)364 1129
y(en)i(la)g(aserci)8 b(\264)-41 b(on)25 b(del)f(mismo\).)120
1423 y Fj(2.5.)119 b(Puntos)30 b(de)g(acceso)f(PHP)266
1610 y Fm(En)e(primer)f(lugar)g(debemos)g(descar)n(gar)h(la)35
b(\264)-41 b(ultima)25 b(v)o(ersi)8 b(\264)-41 b(on)26
b(del)g Fl(phpP)-8 b(oA)26 b Fm(del)g(sitio)g(FTP)h(de)120
1731 y Fl(RedIris)p Fm(:)f Fl(ftp://ftp.r)l(ediris.es/r)l(ediris/papi/)
p Fm(.)c(Descomprimimos)j(el)i(archi)n(v)n(o)g(a)g(alg)8
b(\264)-41 b(un)27 b(lugar)g(en)120 1851 y(nuestro)d(sistema,)g(por)h
(ejemplo,)e Fl(/usr/local)p Fm(/)p Fl(phpP)-8 b(oA)p
Fm(:)364 2069 y Fh(#)50 b(cd)h(/usr/local)364 2189 y(#)f(wget)h
(ftp://ftp.rediris.es/rediris/pap)o(i/php)o(PoA.1.)o(1.tar)o(.gz)364
2310 y(#)f(tar)h(-xzvf)f(phpPoA.1.1.tar.gz)120 2528 y
Fm(As)m(\264)-30 b(\021,)24 b(en)h Fl(/usr/local/phpP)-8
b(oA)22 b Fm(tendremos)i(los)g(contenidos)f(siguientes:)120
2745 y Fl(doc)353 b Fm(la)25 b(documentaci)8 b(\264)-41
b(on)24 b(de)g(la)h(v)o(ersi)8 b(\264)-41 b(on)24 b(del)h
Fl(phpP)-8 b(oA)24 b Fm(instalada.)120 2946 y Fl(etc)381
b Fm(la)32 b(con\002guraci)8 b(\264)-41 b(on)33 b(del)f
Fl(phpP)-8 b(oA)p Fm(.)31 b(Esto)h(incluye)g(un)g(archi)n(v)n(o)g(con)g
(e)o(xtensi)8 b(\264)-41 b(on)31 b Fl(ini)p Fm(,)617
3066 y(\002cheros)e(html)f(de)g(error)l(,)i(y)e(un)g(directorio)h(para)
g(las)f(cla)n(v)o(es)g(criptogr)6 b(\264)-39 b(a\002cas)29
b(utili-)617 3187 y(zadas.)120 3388 y Fl(php)347 b Fm(el)25
b Fl(phpP)-8 b(oA)24 b Fm(propiamente)g(dicho)g(y)h(su)f(librer)m(\264)
-30 b(\021a)25 b(criptogr)6 b(\264)-39 b(a\002ca)25 b(asociada.)120
3588 y Fl(samples)175 b Fm(ejemplos)24 b(de)h(uso)f(del)h
Fl(phpP)-8 b(oA)p Fm(.)120 3789 y Fl(LICENSE)105 b Fm(la)25
b(licencia)g(de)g(distrib)n(uci)8 b(\264)-41 b(on.)120
3990 y Fl(README)98 b Fm(una)25 b(descripci)8 b(\264)-41
b(on)24 b(de)h(los)f(contenidos)g(como)30 b(\264)-39
b(esta.)120 4208 y(Debemos)24 b(ase)o(gurarnos)h(de)g(que)g(la)f
(instalaci)8 b(\264)-41 b(on)24 b(de)h(PHP)h(encuentre)f(el)g(script)f
(del)h Fl(P)-8 b(oA)p Fm(,)25 b(por)f(lo)120 4328 y(que)19
b(incluiremos)e(la)i(ruta)g(completa)f(en)h(el)g(\002chero)g
Fl(php.ini)p Fm(,)f(en)h(debian)f(t)m(\264)-30 b(\021picamente)18
b Fl(/etc/php4/apac)o(he/php.ini)p Fm(.)120 4448 y(Buscamos)24
b(la)h(secci)8 b(\264)-41 b(on)25 b(de)g(rutas)g(y)f(directorios,)g(y)h
(a)8 b(\230)-41 b(nadimos)24 b(las)g(siguientes)g(lineas:)364
4666 y Fh(include)p 727 4666 30 4 v 34 w(path)50 b(=)h
(".:/usr/share/php:/usr/local/phpPoA)o(/php")364 4787
y(phpPoA)p 676 4787 V 35 w(ini)p 864 4787 V 35 w(file)f(=)h
("/usr/local/phpPoA/etc/phpPoA.in)o(i")120 5004 y Fm(Dado)30
b(que)g(P)-9 b(API)30 b(utiliza)f(m)6 b(\264)-39 b(etodos)29
b(criptogr)6 b(\264)-39 b(a\002cos)30 b(que)f(no)h(suelen)f(v)o(enir)h
(instalados)e(por)i(de-)120 5125 y(fecto,)k(deberemos)f(ase)o(gurarnos)
g(de)g(tener)h(instalada)f(la)g(librer)m(\264)-30 b(\021a)34
b Fl(mcrypt)p Fm(.)f(De)h(no)f(estarlo,)g(la)120 5245
y(instalamos:)364 5463 y Fh(#)50 b(apt-get)g(install)f(php4-mcrypt)p
eop end
%%Page: 15 15
TeXDict begin 15 14 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(15)120 407 y(Reiniciamos)24
b(Apache)i(y)f(colocamos)g(alguno)f(de)i(los)e(ejemplos)g(del)i
(directorio)e Fl(samples)h Fm(en)g(el)120 527 y(directorio)e(ra)m(\264)
-30 b(\021z)24 b(de)g(Apache)g(para)g(comprobar)f(que)h(el)f
Fl(P)-8 b(oA)24 b Fm(est)6 b(\264)-39 b(a)23 b(funcionando)g
(correctamente.)120 648 y(La)30 b(con\002guraci)8 b(\264)-41
b(on)30 b(del)g Fl(P)-8 b(oA)29 b Fm(se)h(realiza)h(en)f(el)g(archi)n
(v)n(o)f Fl(phpP)-8 b(oA.ini)p Fm(.)28 b(En)i(dicho)f(archi)n(v)n(o)h
(indi-)120 768 y(caremos)i(las)g(opciones)g(necesarias)g(para)h(la)f
(autenticaci)8 b(\264)-41 b(on)31 b(y)h(autorizaci)8
b(\264)-41 b(on)32 b(de)g(los)g(usuarios)120 888 y(en)27
b(la)g(aplicaci)8 b(\264)-41 b(on)27 b(o)g(aplicaciones)f(que)h
(proteja)g(este)g Fl(P)-8 b(oA)p Fm(.)27 b(La)g(secci)8
b(\264)-41 b(on)27 b([P)-9 b(API)28 b(Main])f(es)g(obli-)120
1009 y(gatoria)e(y)g(de\002ne)h(la)f(con\002guraci)8
b(\264)-41 b(on)25 b(global)g(para)h(todas)e(las)i(aplicaciones.)e
(Aparte,)i(es)f(posible)120 1129 y(de\002nir)30 b(nue)n(v)n(as)f
(secciones)h(que)g(rede\002nan)h(el)f(comportamiento)f(de)h(P)-9
b(API)31 b(para)g(aplicaciones)120 1249 y(concretas.)25
b(Por)g(ejemplo:)364 1478 y Fh([PAPI)p 625 1478 30 4
v 35 w(Main])50 b(Lcook)p 1220 1478 V 35 w(Timeout)f(=)i(86400)364
1598 y(;)f(localizaci)975 1597 y(\264)975 1598 y(on)f(de)h(la)h(base)f
(de)g(datos)g(de)h(peticiones)364 1719 y(;)f(el)h(directorio)e(DB)h
(debe)g(ser)h(propiedad)e(del)h(usuario)364 1839 y(;)g(que)h(ejecuta)e
(apache)h(y)g(tener)g(permisos)g(de)g(escritura)364 1959
y(Request)p 727 1959 V 34 w(DB)h(=)f Fg(/usr/local/phpPoA/var)p
Fh(/DB/request)p 2836 1959 V 30 w(db.db4)364 2080 y(DB)p
472 2080 V 35 w(Type)g(=)h(db4)364 2200 y(;)f(al)h(igual)f(que)g(el)g
(directorio)f(DB,)i(el)f(directorio)f(logs)364 2320 y(;)h(debe)h(tener)
e(permisos)h(suficientes)e(para)i(que)h(el)f(usuario)364
2441 y(;)g(de)h(apache)f(pueda)f(escribir)h(en)1888 2440
y(\264)1888 2441 y(el)364 2561 y(error)p 625 2561 V 35
w(log)g(=)h Fg(/usr/local/phpPoA/var)p Fh(/logs/pa)o(pi)p
2734 2561 V 30 w(error.log)364 2682 y(;)f(si)h(se)f(usa)h(el)f(modo)g
(autom)1635 2681 y(\264)1635 2682 y(atico,)f(se)h(debe)g(proporcionar)
364 2802 y(;)g(la)h(url)f(de)h(los)f(posibles)f(documentos)g(de)h
(error)364 2922 y(Not)p 523 2922 V 35 w(Auth)p 762 2922
V 35 w(Error)p 1052 2922 V 35 w(File)g(=)h Fg(https://foo.urjc.es/)p
Fh(NotAuthori)o(zed.ht)o(ml)364 3043 y(Cookie)p 676 3043
V 35 w(Error)p 966 3043 V 35 w(File)f(=)g Fg(https://foo.urjc.es/)p
Fh(CookieError.)o(html)364 3163 y(System)p 676 3163 V
35 w(Error)p 966 3163 V 35 w(File)g(=)g Fg(https://foo.urjc.es/)p
Fh(SystemError.)o(html)364 3284 y(;)g(definici)873 3283
y(\264)873 3284 y(on)f(de)i(aserciones)e(que)h(se)g(permiten)364
3404 y(PAPI)p 574 3404 V 35 w(Filter)p 915 3404 V 35
w(accept)f(=)i(")p Fg(.*)p Fh(")364 3524 y(;)f(definici)873
3523 y(\264)873 3524 y(on)f(de)i(aserciones)e(que)h(se)g(deniegan)364
3645 y(PAPI)p 574 3645 V 35 w(Filter)p 915 3645 V 35
w(reject)f(=)i(".*")364 3765 y(;)f(Cookie)p 777 3765
V 35 w(Domain)g(is)g(Optional)364 3885 y(Cookie)p 676
3885 V 35 w(Domain)f(=)i(papi.urjc.es)364 4006 y(;)f(clave)g
(compartida)f(con)h(el)h(GPoA)364 4126 y(LKEY)p 574 4126
V 35 w(File)f(=)h Fg(/usr/local/phpPoA/)p Fh(KEYS/lkey)364
4247 y(;)f(clave)g(p)821 4246 y(\264)821 4247 y(ublica)g(del)g(GPoA)364
4367 y(GPoA)p 574 4367 V 35 w(Pub)p 762 4367 V 35 w(Key)h(=)f
Fg(/usr/local/phpPoA)p Fh(/KEYS/)p 2428 4367 V 31 w(GPoA)p
2663 4367 V 35 w(pubkey.pem)364 4487 y(;)g(la)h(url)f(completa)f(del)i
(GPoA,)f(debe)g(coincidir)f(con)h(la)364 4608 y(;)g(definida)g(por)g
(la)g(directiva)g(Auth)p 1997 4608 V 35 w(Location)f(en)h(el)h(GPoA)364
4728 y(GPoA)p 574 4728 V 35 w(URL)f(=)h
(https://gpoa.papi.urjc.es/cookie)p 2546 4728 V 30 w(handler.cgi)364
4969 y([)p Fg(admin)p Fh(])364 5089 y(Location)e(=)i
Fg(/papi/admin)364 5210 y Fh(;)f(Cookie)p 777 5210 V
35 w(Domain)g(is)g(Optional)364 5330 y(Cookie)p 676 5330
V 35 w(Domain)f(=)i(papi.urjc.es)364 5450 y(LKEY)p 574
5450 V 35 w(File)f(=)h Fg(/usr/local/phpPoA/)p Fh(KEYS/lkey)p
eop end
%%Page: 16 16
TeXDict begin 16 15 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(16)364 407 y Fh(GPoA)p
574 407 30 4 v 35 w(Pub)p 762 407 V 35 w(Key)51 b(=)f
Fg(/usr/local/phpPoA/)p Fh(KEYS/)p 2437 407 V 31 w(GPoA)p
2672 407 V 35 w(pubkey.pem)364 527 y(GPoA)p 574 527 V
35 w(URL)g(=)h(https://gpoa.papi.urjc.es/cookie)p 2546
527 V 30 w(handler.cgi)364 648 y(PAPI)p 574 648 V 35
w(Filter)p 915 648 V 35 w(accept)e(=)i(".*")364 768 y(PAPI)p
574 768 V 35 w(Filter)p 915 768 V 35 w(reject)e(=)i(".*")364
888 y(Lcook)p 625 888 V 35 w(Timeout)e(=)i(86400)364
1009 y(Request)p 727 1009 V 34 w(DB)g(=)f Fg(/usr/local/phpPoA/var)p
Fh(/DB/request)p 2836 1009 V 30 w(db.db4)364 1129 y(DB)p
472 1129 V 35 w(Type)g(=)h(db4)364 1249 y(error)p 625
1249 V 35 w(log)f(=)h Fg(/usr/local/phpPoA/var/)p Fh(logs/pa)o(pi)p
2743 1249 V 30 w(error.log)364 1370 y(Not)p 523 1370
V 35 w(Auth)p 762 1370 V 35 w(Error)p 1052 1370 V 35
w(File)f(=)h(https://foo.urjc.es/NotAuthorized.)o(html)364
1490 y(Cookie)p 676 1490 V 35 w(Error)p 966 1490 V 35
w(File)f(=)g(https://foo.urjc.es/CookieError.htm)o(l)364
1611 y(System)p 676 1611 V 35 w(Error)p 966 1611 V 35
w(File)g(=)g(https://foo.urjc.es/SystemError.htm)o(l)120
1839 y Fm(En)20 b(particular)l(,)h(debemos)e(tener)i(en)g(cuenta)f(las)
g(siguientes)f(consideraciones)h(a)h(la)g(hora)f(de)h(tocar)120
1959 y(el)k(\002chero)g(de)g(con\002guraci)8 b(\264)-41
b(on:)191 2188 y(1.)98 b(El)34 b(PoA)g(necesita)g(escribir)g(en)h(dos)e
(lugares)h(concretos,)g(tanto)f(una)i(base)f(de)g(datos)g(de)364
2308 y(peticiones,)18 b(como)g(un)h(archi)n(v)n(o)g(de)g(log.)f
Fb(El)h(pr)n(oceso)h(A)n(pache)g(debe)g(tener)h(los)d(permisos)364
2428 y(necesarios)25 b Fm(para)g(escribir)g(en)g(ambos)f(sitios.)191
2632 y(2.)98 b Fb(El)34 b(modo)g(autom)1043 2631 y(\264)1035
2632 y(atico)g(r)n(edirige)h(al)f(usuario)g(dir)n(ectamente)i
Fm(a)e(los)f(documentos)g(de)364 2752 y(error)k(cuando)g(la)g
(autenticaci)8 b(\264)-41 b(on)36 b(no)h(ha)g(sido)f(correcta.)i(Esto)e
(es)h(interesante)f(cuando)364 2873 y(queremos)28 b(utilizar)f(P)-9
b(API)29 b(como)36 b(\264)-41 b(unica)28 b(alternati)n(v)n(a)f(de)h
(autenticaci)8 b(\264)-41 b(on)28 b(y)g(autorizaci)8
b(\264)-41 b(on.)364 2993 y(Si)26 b(por)g(contra)g(es)g(un)g(m)6
b(\264)-39 b(etodo)24 b(adicional,)i(y)f(queremos)h(presentar)g(al)g
(usuario)f(alternati-)364 3113 y(v)n(as)k(\(por)h(ejemplo,)e(un)i
(formulario)f(en)g(el)h(que)g(introducir)e(nombre)i(de)f(usuario)g(y)h
(con-)364 3234 y(trase)8 b(\230)-41 b(na\))29 b(en)f(caso)h(de)f(que)h
(P)-9 b(API)29 b(no)f(pueda)g(autenticar)l(,)h(debemos)e(desacti)n(v)n
(ar)h(el)g(modo)364 3354 y(autom)6 b(\264)-39 b(atico)24
b(y)g(controlar)h(el)g(v)n(alor)f(de)n(vuelto)f(por)i(la)g(llamada)f(a)
h Fl(c)o(hec)n(k)p 2873 3354 V 36 w(Access\(\))p Fm(.)191
3557 y(3.)98 b Fl(phpP)-8 b(oA)26 b Fm(no)g(implementa)g(un)g
Fl(P)-8 b(oA)27 b Fm(completo.)e(Por)i(eso)g Fb(es)g(necesario)g
(instalar)g(y)f(con-)364 3678 y(\002gurar)g(un)g Fa(GP)-5
b(oA)24 b Fm(al)h(que)g(el)g Fl(phpP)-8 b(oA)24 b Fm(pedir)6
b(\264)-39 b(a)25 b(informaci)8 b(\264)-41 b(on.)24 b(Por)i(tanto)e(en)
h(la)g(con\002gu-)364 3798 y(raci)8 b(\264)-41 b(on)28
b(hay)f(que)h(indicar)g(la)g(URL)g(del)f(mismo,)f(incluyendo)h(la)h
(ruta)g(absoluta)e(indicada)364 3919 y(en)f(la)g(directi)n(v)n(a)e
Fl(A)n(uth)p 1141 3919 V 35 w(Location)h Fm(del)h Fl(GP)-8
b(oA)p Fm(.)191 4122 y(4.)98 b(Los)31 b(\002ltros)g(permiten)f
(determinar)h(la)h(autorizaci)8 b(\264)-41 b(on)30 b(de)i(acceso)g(al)f
Fl(P)-8 b(oA)31 b Fm(para)h(usuarios)364 4242 y(que)d(el)h
Fl(GP)-8 b(oA)29 b Fm(de\002ne)h(como)f(autenticados.)g(Por)h(ello)f
(se)g(especi\002can)i(\002ltros)e(mediante)364 4363 y(e)o(xpresiones)36
b(re)o(gulares)g(de)h(Perl)h(que)f(de\002nan)g(qu)6 b(\264)-39
b(e)37 b(aserciones)g(se)g(aceptan)g(y)g(cu)6 b(\264)-39
b(ales)364 4483 y(se)26 b(denie)o(gan.)g(Lo)g(habitual)g(es)g
Fb(denegar)i(todas)f(salv)o(o)e(aquellas)h(que)i(cumplan)g(cierta)364
4604 y(pr)n(opiedad)e Fm(\(por)f(ejemplo,)f(que)h(el)g(usuario)f
(pertenezca)i(a)f(un)f(grupo)h(concreto\).)120 4832 y(Si)37
b(estamos)e(utilizando)g Fl(P)-9 b(API)42 b Fm(con)37
b(el)f(mecanismo)g(de)g(autenticaci)8 b(\264)-41 b(on)36
b(mediante)g(\223bolitas\224,)120 4952 y(podemos)30 b(conse)o(guir)g
(que)h(las)g(entradas)g(en)g(la)g(p)6 b(\264)-39 b(agina)31
b(del)g(AS)g(para)h Fl(P)-8 b(oAs)30 b Fm(en)h(PHP)h(tambi)6
b(\264)-39 b(en)120 5073 y(tengan)25 b(su)h(imagen)g(asociada)g(\(y)h
(que)f(indique)f(correctamente)i(el)f(estado)g(de)h(las)f(credenciales)
120 5193 y(en)f(dicha)g(aplicaci)8 b(\264)-41 b(on\),)24
b(mediante)g(un)h(sencillo)f(script)g(en)h(PHP:)364 5421
y Fh(<?php)p eop end
%%Page: 17 17
TeXDict begin 17 16 bop 120 100 a Fk(2)99 b(INST)-9 b(ALA)l(CI)805
77 y(\264)781 100 y(ON)26 b(Y)f(CONFIGURA)l(CI)1748 77
y(\264)1723 100 y(ON)1573 b Fm(17)364 407 y Fh($AS)50
b(=)h("https://www.papi.urjc.es/cgi-bin)o(/Auth)o(Server)o(";)364
527 y($BASE)f(=)g("https://sympa.papi.urjc.es/";)364
648 y($YES)g(=)h($BASE.")p Fg(yes.gif)p Fh(";)364 768
y($NO)f(=)h($BASE.")p Fg(no.gif)p Fh(";)364 888 y($)p
421 888 30 4 v 36 w(SERVER['HTTPS'])c(=)k("on";)f(//)g(only)g(if)h(we)f
(use)h(https)364 1009 y Fg(include\('PoA.php'\);)364
1249 y Fh(//)f(check)g(PAPI)g(auth)364 1370 y Fg($auto)59
b(=)g(0;)50 b Fh(//)h(do)f(not)h(use)f(papi)g(auto)g(mode)364
1490 y Fg($poa)59 b(=)g(new)g(PoA\('scheme',$auto\);)364
1611 y Fh(list\($res,$userAssertion\))46 b(=)51 b Fg($poa->check)p
2453 1611 V 33 w(Access\(\);)364 1851 y Fh(//)f(show)g(image)g
(according)f(to)i(auth)f(status)364 1972 y Fg(if)59 b(\($res)g(==)g
(0\))465 2092 y Fh(//)51 b(GPoA)f(doesn't)f(know)h(user)465
2213 y(header\("Location:)e($NO"\);)364 2333 y(else)465
2453 y(header\("Location:)g($YES"\);)364 2574 y(?>)120
2802 y Fm(Guardamos)29 b(el)h(\002chero)h(en)f(el)g(directorio)f(raiz)i
(de)f(Apache)g(y)g(con\002guramos)f(el)h Fl(AS)h Fm(para)f(que)120
2922 y(consulte)24 b(la)h(URL)g(correspondiente)f(al)h(script)f(en)h
(nuestro)f Fl(phpP)-8 b(oA)p Fm(.)120 3218 y Fj(2.6.)119
b(Agrupaciones)31 b(de)f(puntos)h(de)f(acceso)266 3405
y Fm(La)35 b(con\002guraci)8 b(\264)-41 b(on)35 b(de)h(un)e(grupo)h(de)
g(puntos)f(de)h(acceso)g(o)g Fl(GP)-8 b(oA)35 b Fm(es)g(id)6
b(\264)-39 b(entica)34 b(al)h(de)g(un)120 3526 y Fl(P)-8
b(oA)33 b Fm(con)l(v)o(encional,)f(salv)n(o)g(por)h(la)h(inclusi)8
b(\264)-41 b(on)31 b(de)j(algunas)e(directi)n(v)n(as)g(propias)g(del)h
Fl(GP)-8 b(oA)p Fm(.)33 b(A)120 3646 y(continuaci)8 b(\264)-41
b(on)30 b(se)h(muestra)g(una)g(posible)f(con\002guraci)8
b(\264)-41 b(on)31 b(con)g(hosts)f(virtuales)g(de)h(Apache)h(de)120
3766 y(un)25 b Fl(GP)-8 b(oA)p Fm(:)364 3995 y Fh(<VirtualHost)48
b(192.168.84.92:80>)465 4115 y(ServerName)h Fg(gpoa.papi.urjc.es)465
4235 y Fh(RedirectMatch)g(\(.*\))h(https://gpoa.papi.urjc.es/)364
4356 y(</VirtualHost>)364 4597 y(<VirtualHost)e(192.168.84.92:443>)465
4717 y(ServerName)h Fg(gpoa.papi.urjc.es)465 4837 y Fh(ErrorDocument)g
(403)h(https://www.papi.urjc.es/cgi-bin/Au)o(thSer)o(ver)465
4958 y(DocumentRoot)f(/var/www/gpoa/)465 5078 y(<Location)h(/>)567
5198 y(PerlSendHeader)e(On)567 5319 y(PerlAccessHandler)g(PAPI::Main)
567 5439 y(<PAPI)p 828 5439 V 35 w(Local>)p eop end
%%Page: 18 18
TeXDict begin 18 17 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(18)669 407 y Fh(Service)p 1032 407 30 4 v 34 w(ID)51
b(gpoa)669 527 y(Req)p 828 527 V 35 w(DB)f(/usr/local/PAPI/PoA/req)p
2188 527 V 32 w(gpoa)669 648 y Fg(GPoA)p 915 648 V 35
w(Priv)p 1190 648 V 35 w(Key)59 b(/usr/local/PAPI/AS/etc/privk)o(ey.pe)
o(m)714 768 y(GPoA)p 960 768 V 35 w(Hash)p 1235 768 V
34 w(User)p 1509 768 V 35 w(Data)g(0)669 888 y Fh(GPoA)p
879 888 V 35 w(URL)50 b(wayf:built-in)567 1009 y(</PAPI)p
879 1009 V 35 w(Local>)465 1129 y(</Location>)364 1249
y(</VirtualHost>)120 1478 y Fm(La)21 b(directi)n(v)n(a)f
Fl(GP)-8 b(oA)p 853 1478 V 35 w(Priv)p 1060 1478 V 36
w(K)m(e)m(y)21 b Fm(indica)g(al)g Fl(GP)-8 b(oA)21 b
Fm(d)8 b(\264)-41 b(onde)20 b(localizar)h(la)g(cla)n(v)o(e)g(pri)n(v)n
(ada)f(con)h(la)g(que)120 1598 y(encriptar)e(los)f(datos)g(asociados)h
(a)g(sus)f(respuestas,)g(mientras)g(que)h(la)g(directi)n(v)n(a)f
Fl(GP)-8 b(oA)p 3147 1598 V 35 w(Hash)p 3393 1598 V 35
w(User)p 3622 1598 V 36 w(Data)120 1719 y Fm(indica)30
b(si)g(el)g Fl(GP)-8 b(oA)30 b Fm(debe)h(aplicar)f(una)g(funci)8
b(\264)-41 b(on)30 b(hash)g(sobre)g(los)g(datos)g(del)g(usuario)g
(antes)g(de)120 1839 y(en)l(viarlos.)j(En)g(caso)h(de)g(acti)n(v)n
(arse)f(\()p Fb(1)p Fm(\))h(los)e(datos)i(jam)6 b(\264)-39
b(as)33 b(se)g(en)l(viar)6 b(\264)-39 b(an)34 b(en)g(claro,)g(y)f(por)h
(tanto)120 1959 y(los)f(puntos)g(de)h(acceso)g(\002nales)g(no)g(podr)6
b(\264)-39 b(an)33 b(acceder)i(a)g(ellos,)e(mientras)g(que)g(manteni)6
b(\264)-39 b(endola)120 2080 y(desacti)n(v)n(ada)27 b(\()p
Fb(0)p Fm(\))g(nos)h(ase)o(guramos)e(de)i(que)g(los)f(clientes)g
(puedan)g(acceder)i(a)f(dichos)f(datos)g(\(lo)120 2200
y(cual)j(puede)f(suponer)h(un)f(riesgo)g(de)h(se)o(guridad\).)f
(Adicionalmente,)f(y)i(mediante)f(la)g(directi)n(v)n(a)120
2320 y Fl(GP)-8 b(oA)p 362 2320 V 35 w(Re)o(write)p Fm(,)29
b(podemos)f(controlar)h(la)g(informaci)8 b(\264)-41 b(on)28
b(que)i(en)l(viamos)e(a)h(cada)h Fl(P)-8 b(oA)29 b Fm(subordi-)120
2441 y(nado.)36 b(La)g(directi)n(v)n(a)e(recibe)j(tres)e(par)6
b(\264)-39 b(ametros.)36 b(El)g(primero,)f(una)h(e)o(xpresi)8
b(\264)-41 b(on)35 b(re)o(gular)g(que)h(se)120 2561 y(comparar)6
b(\264)-39 b(a)27 b(con)f(el)g(nombre)g(del)g Fl(P)-8
b(oA)p Fm(,)26 b(el)h(se)o(gundo)e(una)h(e)o(xpresi)8
b(\264)-41 b(on)25 b(re)o(gular)h(que)h(se)f(aplicar)6
b(\264)-39 b(a)27 b(a)120 2682 y(la)d(aserci)8 b(\264)-41
b(on)24 b(emitida)e(por)i(el)g Fl(GP)-8 b(oA)p Fm(,)23
b(y)h(el)g(tercero)g(el)g(patr)8 b(\264)-41 b(on)23 b(con)h(el)g(que)g
(se)f(debe)h(sobreescribir)120 2802 y(dicha)h(aserci)8
b(\264)-41 b(on.)266 2922 y(Por)34 b(\264)-41 b(ultimo,)23
b(si)h(queremos)h(que)g(el)g Fl(GP)-8 b(oA)24 b Fm(no)h(aparezca)i
(como)d(opci)8 b(\264)-41 b(on)24 b(en)h(la)g(lista)g(de)g
Fl(P)-8 b(oAs)120 3043 y Fm(disponibles)37 b(para)j(un)f(usuario,)g
(bastar)6 b(\264)-39 b(a)40 b(con)f(que)g(modi\002quemos)f(su)h
(con\002guraci)8 b(\264)-41 b(on)40 b(en)f(el)120 3163
y(LD)l(AP)-11 b(,)25 b(dejando)f(el)h(campo)g Fl(papiSiteService)e
Fm(v)n(ac)m(\264)-30 b(\021o)24 b(\(con)h(uno)g(o)f(m)6
b(\264)-39 b(as)25 b(espacios\).)120 3503 y Fn(3.)143
b(Integraci)943 3501 y(\264)931 3503 y(on)33 b(con)i(aplicaciones)266
3726 y Fm(A)23 b(continuaci)8 b(\264)-41 b(on)21 b(se)i(encuentran)f
(detalladas)g(las)g(implementaciones)f(concretas)h(para)h(cada)120
3847 y(aplicaci)8 b(\264)-41 b(on)24 b(inte)o(grada)g(en)h(el)g
(sistema)f Fl(P)-9 b(API)30 b Fm(de)25 b(la)g(uni)n(v)o(ersidad.)120
4142 y Fj(3.1.)119 b(Safari)30 b(\(publicaciones)h(online\))266
4329 y Fl(Safari)d Fm(es)h(un)g(servicio)g(online)f(de)h
Fl(O'Reilly)g Fm(mediante)f(el)h(cual)h(se)f(pueden)g(consultar)f(pu-)
120 4450 y(blicaciones)c(desde)h(cualquier)f(direcci)8
b(\264)-41 b(on)25 b(IP)g(de)g(la)g(uni)n(v)o(ersidad.)d(Nuestra)j
(intenci)8 b(\264)-41 b(on)23 b(es)i(poder)120 4570 y(utilizar)33
b(dicho)g(servicio)g(desde)g(cualquier)h(ubicaci)8 b(\264)-41
b(on)32 b(\(no)i(s)8 b(\264)-41 b(olo)32 b(desde)i(la)f(uni)n(v)o
(ersidad\))f(me-)120 4690 y(diante)k(una)g(autenticaci)8
b(\264)-41 b(on)36 b(pre)n(via.)f(P)o(ara)i(ello)f(instalamos)f(un)h
(servidor)f(que)i(actuar)6 b(\264)-39 b(a)37 b(como)120
4811 y Fl(pr)l(oxy)24 b(P)-8 b(oA)p Fm(,)25 b(y)f(lo)h(con\002guramos)f
(de)h(la)g(siguiente)f(manera:)364 5039 y Fh(<VirtualHost)48
b(192.168.84.92:80>)465 5160 y(ServerName)h Fg(safari.papi.urjc.es)474
5280 y(RedirectMatch)57 b(/index.html)1012 5400 y
(https://safari.papi.urjc.es/ind)o(ex.ht)o(ml)p eop end
%%Page: 19 19
TeXDict begin 19 18 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(19)465 407 y Fh(ErrorDocument)49 b(404)h
(https://safari.papi.urjc.es/index.h)o(tml)364 527 y(</VirtualHost>)364
768 y(<VirtualHost)e(192.168.84.92:443>)465 888 y(ServerName)h
Fg(safari.papi.urjc.es)465 1009 y Fh(ErrorDocument)g(403)h
(https://www.papi.urjc.es/cgi-bin/Au)o(thSer)o(ver)465
1129 y(<Location)g(/>)567 1249 y(PerlSendHeader)e(On)567
1370 y(PerlAccessHandler)g(PAPI::Main)567 1490 y(<PAPI)p
828 1490 30 4 v 35 w(Local>)669 1611 y(Service)p 1032
1611 V 34 w(ID)j(safari)669 1731 y(Req)p 828 1731 V 35
w(DB)f(/usr/local/PAPI/PoA/req)p 2188 1731 V 32 w(safari)669
1851 y(GPoA)p 879 1851 V 35 w(URL)g(wayf:built-in)714
1972 y Fg(Remote)p 1080 1972 V 34 w(URL)59 b(http://safari.oreilly.com)
567 2092 y Fh(</PAPI)p 879 2092 V 35 w(Local>)465 2213
y(</Location>)364 2333 y(</VirtualHost>)120 2628 y Fj(3.2.)119
b(LAP)-9 b(A)30 b(\(aplicaci)1206 2627 y(\264)1196 2628
y(on)h(de)g(comunicaciones\))266 2816 y Fm(En)24 b(esta)g(aplicaci)8
b(\264)-41 b(on)24 b(el)g(m)6 b(\264)-39 b(etodo)23 b(de)i(autenticaci)
8 b(\264)-41 b(on)23 b(consist)m(\264)-30 b(\021a)23
b(en)h(un)g(usuario)g(y)g(contrase)8 b(\230)-41 b(na)120
2936 y(con)28 b(los)f(que)h(se)g(creaba)h(una)f(sesi)8
b(\264)-41 b(on)27 b(que)g(se)h(comprobaba)g(el)g(resto)f(del)h
(tiempo.)f(En)g(su)h(lugar)l(,)120 3056 y(crearemos)h(un)f
Fl(inde)n(x.php)f Fm(que)i(compruebe)f(las)g(credenciales)h(de)f(P)-9
b(API)30 b(y)e(haga)g(lo)g(necesario)120 3177 y(para)22
b(autenticar)f(al)h(usuario)e(en)i(caso)g(de)f(que)g(no)h(lo)f(est)6
b(\264)-39 b(e)21 b(ya)h(\(en)f(este)h(caso,)f(redirigirle)g(al)g
Fl(GP)-8 b(oA)120 3297 y Fm(asociado\).)38 b(Cuando)h(las)g
(credenciales)g(sean)g(las)f(esperadas,)h(se)g(le)g(crear)6
b(\264)-39 b(a)40 b(una)e(sesi)8 b(\264)-41 b(on)38 b(que)120
3418 y(servir)6 b(\264)-39 b(a)31 b(para)f(identi\002carle)h(hasta)f
(que)g(cierre)i(la)e(aplicaci)8 b(\264)-41 b(on,)30 b(de)g(modo)g(que)g
(no)g(es)h(necesario)120 3538 y(tocar)i(ning)8 b(\264)-41
b(un)32 b(c)8 b(\264)-41 b(odigo)32 b(de)h(la)g(misma,)e(sino)h(que)h
(basta)g(con)g(incluir)f(un)g Fl(inde)n(x.php)g Fm(similar)g(al)120
3658 y(que)25 b(sigue:)364 3887 y Fh(<?php)364 4007 y($AS)50
b(=)h("https://www.papi.urjc.es/cgi-bin)o(/Auth)o(Server)o(";)364
4127 y(session)p 727 4127 V 34 w(start\(\);)364 4248
y(include\('/var/www/include/dbconnec)o(tv2.p)o(hp'\);)364
4368 y(include\('/var/www/clases/c)p 1696 4368 V 31 w(log.php'\);)364
4489 y Fg(include'PoA.php';)364 4729 y Fh(//logs)364
4850 y($log->seccion)d(=)j("autenticacion";)364 4970
y($log->operador)d(=)j($correo;)364 5211 y Fg($poa)59
b(=)g(new)g(PoA\('lapa'\);)364 5331 y Fh(list\($res,)49
b($userAssertion\))f(=)i Fg($poa->check)p 2503 5331 V
34 w(Access\(\))p Fh(;)p eop end
%%Page: 20 20
TeXDict begin 20 19 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(20)364 407 y Fg(if)59 b(\($res)g(==)g(0\))51 b Fd(f)465
527 y Fh(//)g(el)f(GPoA)g(no)h(autentica)465 648 y(header\("Location:)d
($AS"\);)465 768 y(exit;)364 888 y Fd(g)364 1129 y Fh
(list\($mail,$set\))g(=)i(split\(",",$userAssertion,2\);)364
1249 y(list\($login,$domain\))d(=)j(split\("@",$mail,2\);)364
1370 y($consulta)f(=)i(mysql)p 1235 1370 30 4 v 34 w(query\("select)e
(*)h(from)g(operadores)f(where)h(login='$login'"\);)364
1490 y(if)g(\(mysql)p 828 1490 V 35 w(num)p 1016 1490
V 35 w(rows\($consulta\))e(==)j(0\))f Fd(f)465 1611 y
Fh(//No)h(esta)f(en)g(la)g(tabla)g(de)h(operadores)465
1731 y(header\("Location:)d($AS"\);)465 1851 y(exit;)364
1972 y Fd(g)364 2213 y Fh(//)i(autenticado)f(con)1329
2212 y(\264)1329 2213 y(exito)h(por)g(PAPI,)g(y)h(es)f(operador)364
2333 y(if)g(\(session)p 930 2333 V 35 w(is)p 1067 2333
V 35 w(registered\("SESSION"\)\))465 2453 y(session)p
828 2453 V 35 w(unregister\("SESSION"\);)364 2574 y Fg(session)p
790 2574 V 34 w(register\("SESSION"\);)364 2694 y($SESSION["login"])56
b(=)j($login;)364 2814 y Fh($log->descripcion)47 b(=)k("Exito)f(en)g
(la)h(autenticacion";)364 2935 y($log->putlog\(\);)364
3176 y Fg(header\("Location:)56 b(/main.php"\);)364 3296
y Fh(exit;)364 3416 y(?>)120 3645 y Fm(En)26 b(este)g(ejemplo)f(se)h
(incluye)f(c)8 b(\264)-41 b(odigo)26 b(que)g(se)g(utilizaba)f(en)h(el)g
(antiguo)f(sistema)g(de)h(autentica-)120 3765 y(ci)8
b(\264)-41 b(on)31 b(para)i(crear)g(la)e(sesi)8 b(\264)-41
b(on)31 b(y)h(guardar)g(un)g(hist)8 b(\264)-41 b(orico)30
b(de)i(accesos.)g(En)g Fb(negrita)g Fm(se)g(encuentra)120
3885 y(el)i(c)8 b(\264)-41 b(odigo)32 b(m)6 b(\264)-39
b(as)33 b(importante)g(desde)g(nuestro)g(punto)g(de)g(vista,)g(que)g
(se)h(encar)n(ga)g(de)g(consultar)120 4006 y(al)c Fl(P)-8
b(oA)30 b Fm(las)g(credenciales)h(del)e(usuario,)h(y)g(redirigirle,)g
(bien)f(al)i Fl(AS)p Fm(,)e(bien)h(a)h(otro)e(\002chero)i(PHP)120
4126 y(pre)n(via)24 b(creaci)8 b(\264)-41 b(on)26 b(de)f(una)f(sesi)8
b(\264)-41 b(on,)24 b(en)h(funci)8 b(\264)-41 b(on)25
b(de)f(las)h(mismas.)120 4421 y Fj(3.3.)119 b(HORDE)30
b(\(corr)n(eo)g(web\))266 4609 y Fl(Hor)l(de)37 b Fm(es)g(el)g(sistema)
e(de)i(correo)g(web)g(utilizado)f(en)g(la)h(uni)n(v)o(ersidad.)e
(Permite)h(la)h(utili-)120 4729 y(zaci)8 b(\264)-41 b(on)38
b(de)f(diferentes)h(servidores)f(IMAP)h(y)f(por)h(tanto)f(dar)h(acceso)
g(a)g(v)n(arios)e(dominios)g(de)120 4850 y(correo.)43
b(P)o(artiendo)f(de)h(la)f(base)h(de)g(que)f(tenemos)g
Fl(Hor)l(de)g Fm(con\002gurado)h(y)f(que)h(utilizamos)120
4970 y Fl(IMP)g Fm(para)g(la)g(autenticaci)8 b(\264)-41
b(on,)42 b(lo)50 b(\264)-41 b(unico)42 b(que)h(tenemos)f(que)g(hacer)i
(es)f(sustituir)e(el)h(\002chero)120 5090 y Fl(inde)n(x.php)37
b Fm(de)i Fl(Hor)l(de)f Fm(por)g(uno)f(ligeramente)h(modi\002cado.)f
(Encontraremos)h(el)g(original)f(en)120 5211 y Fl(/usr/shar)l(e/hor)l
(de3/inde)n(x.php)p Fm(.)21 b(Realizamos)j(una)h(copia)f(de)h(se)o
(guridad)e(y)i(editamos)e(su)h(conte-)120 5331 y(nido:)p
eop end
%%Page: 21 21
TeXDict begin 21 20 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(21)364 527 y Fh(#)50 b(cp)h(/usr/share/horde3/index.php)46
b(/usr/share/horde3/index.php.bak)364 648 y(#)k(vi)h
(/usr/share/horde3/index.php)120 876 y Fm(Un)28 b Fl(inde)n(x.php)g
Fm(similar)f(al)i(siguiente)e(servir)6 b(\264)-39 b(a)29
b(para)g(que)f(los)g(usuarios)g(puedan)g(acceder)i(direc-)120
996 y(tamente)25 b(a)i(su)e(b)n(uz)8 b(\264)-41 b(on)26
b(si)f(ya)i(est)6 b(\264)-39 b(an)25 b(identi\002cados)h(en)g
Fl(P)-9 b(API)p Fm(,)26 b(y)f(sean)i(redirigidos)d(al)i
Fl(AS)h Fm(en)f(caso)120 1117 y(contrario:)364 1345 y
Fh(<?php)364 1465 y(/**)415 1586 y(*)50 b($Horde:)g(horde/index.php,v)d
(2.105.4.3)i(2005/03/02)g(07:10:35)h(chuck)f(Exp)i($)415
1706 y(*)415 1826 y(*)f(Copyright)f(1999-2005)g(Charles)h(J.)g
(Hagenbuch)f(<chuck@horde.org>)415 1947 y(*)h(Copyright)f(1999-2005)g
(Jon)i(Parise)e(<jon@horde.org>)415 2067 y(*)415 2188
y(*)h(See)h(the)f(enclosed)f(file)h(COPYING)g(for)g(license)f
(information)g(\(LGPL\).)100 b(If)51 b(you)415 2308 y(*)f(did)h(not)f
(receive)f(this)h(file,)g(see)g(http://www.fsf.org/copyleft/lgpl.html)o
(.)415 2428 y(*/)364 2669 y(@define\('AUTH)p 1033 2669
30 4 v 33 w(HANDLER',)f(true\);)364 2790 y(@define\('HORDE)p
1084 2790 V 33 w(BASE',)h('/usr/share/horde3'\);)364
2910 y($horde)p 676 2910 V 35 w(configured)e(=)770 3030
y(\(@file)p 1082 3030 V 35 w(exists\(HORDE)p 1729 3030
V 34 w(BASE)i(.)g('/config/conf.php'\))d(&&)821 3151
y(@file)p 1082 3151 V 35 w(exists\(HORDE)p 1729 3151
V 34 w(BASE)j(.)g('/config/mime)p 2781 3151 V 34 w(drivers.php'\))e(&&)
821 3271 y(@file)p 1082 3271 V 35 w(exists\(HORDE)p 1729
3271 V 34 w(BASE)i(.)g('/config/nls.php'\))e(&&)821 3391
y(@file)p 1082 3391 V 35 w(exists\(HORDE)p 1729 3391
V 34 w(BASE)i(.)g('/config/prefs.php'\))d(&&)821 3512
y(@file)p 1082 3512 V 35 w(exists\(HORDE)p 1729 3512
V 34 w(BASE)j(.)g('/config/registry.php'\)\);)364 3753
y(if)g(\(!$horde)p 930 3753 V 35 w(configured\))e Fd(f)567
3873 y Fh(require)i(HORDE)p 1235 3873 V 34 w(BASE)h(.)f
('/lib/Test.php';)567 3993 y(Horde)p 828 3993 V 35 w
(Test::configFilesMissing\('Horde',)45 b(HORDE)p 2846
3993 V 34 w(BASE,)50 b('prefs.php',)669 4114 y(array\('conf.php')d(=>)k
('This)f(is)g(the)g(main)g(Horde)g(configuration)f(file.)h(It)p
Fd(n)821 4234 y Fh(contains)f(paths)h(and)h(basic)e(items)h(that)g
(apply)g(to)h(the)f(core)p Fd(n)821 4355 y Fh(framework)f(and)h(all)h
(Horde)f(applications.',)770 4475 y('mime)p 1031 4475
V 35 w(drivers.php')f(=>)h('This)g(file)g(controls)f(the)i(global)e
(set)i(of)p Fd(n)821 4595 y Fh(MIME)101 b(drivers)49
b(for)i(the)f(Horde)g(framework,)f(allowing)g(applications)p
Fd(n)821 4716 y Fh(to)i(make)f(use)g(of)g(programs)g(such)g(as)g
(enscript)f(or)i(mswordview)e(to)p Fd(n)821 4836 y Fh(render)101
b(content)49 b(into)h(HTML)g(for)g(viewing)g(in)g(a)h(browser.',)770
4956 y('nls.php')e(=>)i('This)f(file)g(provides)f(localisation)g
(support)g(for)h(the)p Fd(n)821 5077 y Fh(Horde)g(framework.',)770
5197 y('registry.php')e(=>)j('The)f(registry)f(is)i(how)f(Horde)g
(applications)e(find)p Fd(n)821 5318 y Fh(out)i(how)h(to)f(talk)g(to)h
(each)f(other.)f(You)h(should)g(list)g(any)g(installed)p
Fd(n)821 5438 y Fh(Horde)g(applications)f(that)h(you)g(have)g
(here.'\)\);)p eop end
%%Page: 22 22
TeXDict begin 22 21 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(22)364 407 y Fd(g)364 648 y Fh(require)p 727 648
30 4 v 34 w(once)50 b(HORDE)p 1270 648 V 35 w(BASE)g(.)h
('/lib/base.php';)364 768 y(//)f(a)567 767 y(\230)567
768 y(nadimos)g(la)g(biblioteca)f(criptogr)2093 767 y(\264)2093
768 y(afica)f(de)j(Horde)364 888 y Fg(require)p 790 888
V 34 w(once)59 b(HORDE)p 1423 888 V 35 w(BASE)g(.)g
('/lib/Horde/Secret.php';)364 1129 y Fh(if)50 b
(\($browser->isMobile\(\)\))d Fd(f)567 1249 y Fh(require)j(HORDE)p
1235 1249 V 34 w(BASE)h(.)f('/services/portal/mobile.php';)567
1370 y(exit;)364 1490 y Fd(g)364 1731 y Fh($main)p 625
1731 V 35 w(page)g(=)g(Util::getFormData\('url'\);)364
1851 y(if)g(\(!$main)p 879 1851 V 35 w(page\))g Fd(f)567
1972 y Fh($main)p 828 1972 V 35 w(page)g(=)h(Horde::initialPage\(\);)
364 2092 y Fd(g)364 2333 y Fh(//)f(autenticamos)f(mediante)g(PAPI)364
2453 y($AS)h(=)h("https://www.papi.urjc.es/cgi-bin)o(/Auth)o(Server)o
(";)364 2574 y($)p 421 2574 V 36 w(SERVER['HTTPS'])c(=)k("on";)f(//)g
(s)1873 2573 y(\264)1873 2574 y(olo)g(si)h(usamos)f(https)364
2694 y Fg(include\('PoA.php'\);)364 2935 y($poa)59 b(=)g(new)g
(PoA\('horde'\);)364 3055 y Fh(list\($res,$userAssertion\))46
b(=)51 b Fg($poa->check)p 2453 3055 V 33 w(Access\(\))p
Fh(;)364 3296 y(//)f(si)h(no)f(est)974 3295 y(\264)974
3296 y(a)g(autenticado,)f(redirigimos)f(al)j(AS)364 3416
y Fg(if)59 b(\($res)g(==)g(0\))51 b Fd(f)465 3537 y Fh
(header\("Location:)d($AS"\);)465 3657 y(exit;)364 3778
y Fd(g)364 4018 y Fh(//)i(parseo)g(de)g(la)h(asercion)364
4139 y(list\()p Fg($mail)p Fh(,$other\))c(=)k
(split\(",",$userAssertion,2\);)364 4259 y(list\()p Fg($imapuser)p
Fh(,)p Fg($server)p Fh(\))46 b(=)k Fg(split\("@",$mail,2\);)364
4379 y Fh(list\()p Fg($pass)p Fh(,$AS\))e(=)i(split\("@",$other,2\);)
364 4620 y(if)g(\($imapuser)f(==)i('')f(||)g($pass)g(==)h(''\))f
Fd(f)567 4741 y Fh(header\("Location:)e($AS"\);)567 4861
y(exit;)364 4981 y Fd(g)364 5222 y Fh(//)i(rellenamos)f(las)h
(variables)g(post)g(del)g(formulario)f(de)h(login)364
5342 y($)p 421 5342 V 36 w(POST['imapuser'])d(=)k($imapuser;)364
5463 y($)p 421 5463 V 36 w(POST['pass'])d(=)j($pass;)p
eop end
%%Page: 23 23
TeXDict begin 23 22 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(23)364 407 y Fg($)p 430 407 30 4 v 36 w(POST['autologin'])55
b(=)60 b("0";)364 527 y Fh($)p 421 527 V 36 w(POST['mailbox'])47
b(=)k("INBOX";)364 648 y Fg($)p 430 648 V 36 w(POST['load)p
1066 648 V 33 w(frameset'])58 b(=)h("1";)364 768 y Fh($)p
421 768 V 36 w(POST['actionID'])47 b(=)k("";)364 888
y($)p 421 888 V 36 w(POST['folders'])c(=)k("INBOX.";)364
1009 y Fg($)p 430 1009 V 36 w(POST['url'])57 b(=)i("index.php";)364
1129 y Fh($)p 421 1129 V 36 w(POST['new)p 916 1129 V
34 w(lang'])49 b(=)i("es)p 1560 1129 V 35 w(ES";)364
1370 y(/*)f(codigo)g(espec)1127 1369 y(\264)1127 1370
y(\021fico)f(para)h(los)g(servidores)f(de)h(correo)g(configurados)618
1490 y(habr)822 1489 y(\264)822 1490 y(\021a)g(que)g(cambiarlo!)f(*/)
364 1611 y(if)h(\($server)g(==)g("alumnos.urjc.es"\))465
1731 y Fg($server)59 b(=)g("imapALUMNOS";)364 1851 y
Fh(if)50 b(\($server)g(==)g("urjc.es"\))465 1972 y Fg($server)59
b(=)g("imapURJC";)364 2092 y Fh($)p 421 2092 V 36 w(POST['server'])48
b(=)i($server;)364 2333 y(if)g(\(!Util::getFormData\('frameset)p
2001 2333 V 31 w(loaded'\))f(&&)567 2453 y(\($conf['menu']['always'])d
(||)618 2574 y(\(Auth::getAuth\(\))i(&&)i($prefs->getValue\('show)p
2762 2574 V 32 w(sidebar'\)\)\)\))e Fd(f)567 2694 y Fh(if)j
(\($browser->hasQuirk\('scrollbar)p 2256 2694 V 30 w(in)p
2388 2694 V 35 w(way'\)\))f Fd(f)770 2814 y Fh($scrollbar)f(=)i('yes';)
567 2935 y Fd(g)g Fh(else)f Fd(f)770 3055 y Fh($scrollbar)f(=)i
('auto';)567 3176 y Fd(g)567 3296 y Fh(/*)g(nos)f(aseguramos)f(de)h
(mantener)f(la)i(password)e(en)i(la)f(variable)f(de)821
3416 y(sesion)h(en)g(caso)g(de)h(que)f(no)g(sea)h(nuestro)e(primer)h
(acceso)f(*/)567 3537 y Fg($)p 633 3537 V 36 w(SESSION['imp']['pass'])
55 b(=)k(Secret::write\()1192 3657 y(Secret::getKey\('imp'\),)c
($pass\);)567 3778 y Fh(require)50 b(HORDE)p 1235 3778
V 34 w(TEMPLATES)g(.)g('/index/frames)p 2593 3778 V 33
w(index.inc';)364 3898 y Fd(g)g Fh(else)h Fd(f)567 4018
y Fh(//)g(tras)f(rellenar)f(a)h(mano)h(el)f(formulario,)f(lo)h
("enviamos")567 4139 y Fg(require)58 b(HORDE)p 1351 4139
V 35 w(BASE)h(.)g('/imp/redirect.php';)364 4259 y Fd(g)364
4379 y Fh(?>)120 4673 y Fj(3.4.)119 b(SYMP)-9 b(A)31
b(\(listas)e(de)h(corr)n(eo\))266 4861 y Fm(En)k(el)g(caso)g(del)g
(gestor)g(de)g(listas)f(de)h(correo)g(no)g(se)g(puede)g(utilizar)f(el)h
Fl(phpP)-8 b(oA)p Fm(,)33 b(pero)i(si)120 4981 y(un)f
Fl(P)-8 b(oA)33 b Fm(con)l(v)o(encional,)g(con)h(la)g(particularidad)g
(de)g(que)g(es)g(necesario)g(adaptar)h Fl(Sympa)f Fm(para)120
5102 y(que)f(utilice)f(dicho)g Fl(P)-8 b(oA)32 b Fm(como)g(sistema)g
Fl(single-sign-on)p Fm(.)f(P)o(ara)i(ello)f(es)h(necesario)g
(modi\002car)120 5222 y(el)k(c)8 b(\264)-41 b(odigo)37
b(del)g(propio)f Fl(Sympa)h Fm(y)g(crear)i(conectores)e(que)g(se)h
(encar)n(guen)g(de)f(enlazar)h(con)f(la)120 5342 y(funcionalidad)24
b(proporcionada)g(por)h Fl(P)-9 b(API)p Fm(.)266 5463
y(En)24 b(nuestro)g(caso,)g(por)g(sencillez,)g(es)g(preferible)h
(con\002gurar)f(un)g(proxy)g(de)g(reescritura)h(que)p
eop end
%%Page: 24 24
TeXDict begin 24 23 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(24)120 407 y(utilice)26 b(el)i(autocompletado)e(de)h(formularios)f
(para)i(rellenar)g(el)f(mismo)f(autom)6 b(\264)-39 b(aticamente.)26
b Fb(Es)120 527 y(necesario)g(modi\002car)g(la)f(plantilla)g(principal)
h(de)g(Sympa)g(ya)f(que)i(no)f(incluy)o(e)g(nombr)n(e)g(en)120
648 y(sus)19 b(f)n(ormularios)p Fm(.)f(P)o(ara)h(ello,)g(editamos)e(el)
i(archi)n(v)n(o)f Fl(/usr/shar)l(e/sympa/wws)p 2877 648
30 4 v 34 w(templates/lo)o(ginbanner)-11 b(.es.tpl)120
768 y Fm(y)28 b(en)h(la)f(l)m(\264)-30 b(\021nea)28 b(17)g(a)8
b(\230)-41 b(nadimos)27 b(el)h(atrib)n(uto)g Fl(N)m(AME=lo)o(gin)p
Fm(.)f(Con\002guramos)h(adicionalmente)f(un)120 888 y
Fl(virtual)d(host)h Fm(de)g(apache)h(para)f(nuestro)f(proxy)-6
b(,)24 b(del)h(siguiente)e(modo:)364 1117 y Fh(<VirtualHost)48
b(192.168.84.92:80>)465 1237 y(ServerName)h Fg(sympa.papi.urjc.es)465
1357 y Fh(RedirectMatch)g(\(.*\))h Fg(https://sympa.papi.urjc.es/)364
1478 y Fh(</VirtualHost>)364 1719 y(<VirtualHost)e(192.168.84.92:443>)
465 1839 y(ServerName)h Fg(sympa.papi.urjc.es)465 1959
y Fh(<Location)h(/>)567 2080 y(PerlSendHeader)e(On)567
2200 y(PerlAccessHandler)g(PAPI::Main)567 2320 y(<PAPI)p
828 2320 V 35 w(Local>)669 2441 y(Service)p 1032 2441
V 34 w(ID)j Fg(sympa)669 2561 y Fh(Req)p 828 2561 V 35
w(DB)f(/usr/local/PAPI/PoA/req)p 2188 2561 V 32 w(sympa)669
2682 y(GPoA)p 879 2682 V 35 w(URL)g(wayf:built-in)669
2802 y Fg(Remote)p 1035 2802 V 34 w(URL)59 b(https://listas.urjc.es)669
2922 y(Redirect)p 1155 2922 V 34 w(All)g(1)669 3043 y(PAPI)p
915 3043 V 35 w(Redirect)f(listas.urjc.es\(.*?\))d
(sympa.papi.urjc.es$1)669 3163 y(Eval)p 915 3163 V 35
w(Proxy)p 1250 3163 V 34 w(Redirects)j(1)669 3284 y(Form)p
915 3284 V 35 w(Processor)f(urle=>\210/wws.*)g(form=>login)1012
3404 y(buttonName=>action)p 2098 3404 V 32 w(login)1012
3524 y(field=>\(passwd,$r->notes\('PAPIA)o(ttr-p)o(assw)o(ord'\))o(\))
1012 3645 y(field=>\(email,$r->notes\('PAPIAt)o(tr-us)o(erna)o(me'\)\))
567 3765 y Fh(</PAPI)p 879 3765 V 35 w(Local>)465 3885
y(</Location>)364 4006 y(</VirtualHost>)120 4301 y Fj(3.5.)119
b(GENTE)29 b(\(dir)n(ectorio\))266 4489 y Fm(Gente)35
b(es)h(la)f(aplicaci)8 b(\264)-41 b(on)35 b(de)g(directorio)g
(utilizada)f(en)h(la)g(uni)n(v)o(ersidad,)e(y)j(se)f(utiliza)f(adi-)120
4609 y(cionalmente)26 b(para)i(que)e(el)h(personal)g(modi\002que)f(sus)
g(datos)h(personales,)f(entre)i(los)e(que)h(se)g(en-)120
4729 y(cuentran,)32 b(por)f(ejemplo,)g(el)h(nombre)f(de)h(usuario)f(y)h
(la)f(contrase)8 b(\230)-41 b(na)32 b(que)g(utilizar)6
b(\264)-39 b(a)31 b(P)-9 b(API)33 b(para)120 4850 y(autenticar)-5
b(.)27 b(Es)f(por)i(tanto)e(una)h(aplicaci)8 b(\264)-41
b(on)27 b(un)g(poco)g(especial,)g(ya)g(que)h(acepta)f(dos)g(formas)g
(de)120 4970 y(autenticaci)8 b(\264)-41 b(on)30 b(a)g(tra)n(v)6
b(\264)-39 b(es)30 b(del)h(mismo)d(formulario.)i(Cuando)g(un)g(usuario)
g(no)g(tiene)g(un)g(nombre)120 5090 y(de)c(usuario)g(y)g(una)g
(contrase)8 b(\230)-41 b(na,)26 b(deber)6 b(\264)-39
b(a)27 b(hacer)g(login)e(con)h(su)g(NIF)g(y)g(su)g(fecha)h(de)f
(nacimiento,)120 5211 y(ambos)k(v)n(alores)h(almacenados)g(en)g(una)g
(base)h(de)f(datos.)g(T)m(ras)g(identi\002carse)g(por)g(primera)g(v)o
(ez)120 5331 y(y)i(ele)o(gir)g(un)g(nombre)g(de)h(usuario)f(y)g
(contrase)8 b(\230)-41 b(na,)33 b(esta)h(forma)f(de)h(acceso)g(no)f(v)n
(olv)o(er)6 b(\264)-39 b(a)33 b(a)h(per)n(-)120 5452
y(mitirse)27 b(para)h(este)g(usuario.)g(Por)g(si)g(fuera)g(poco,)g(s)8
b(\264)-41 b(olo)27 b(se)h(permite)g(el)g(acceso)g(autenticado)g(\(de)p
eop end
%%Page: 25 25
TeXDict begin 25 24 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(25)120 407 y(cualquier)25 b(forma\))h(a)g(tra)n(v)6
b(\264)-39 b(es)26 b(de)f(la)h(propia)f(red)h(de)g(la)g(uni)n(v)o
(ersidad,)d(lo)i(cual)h(complica)f(a)8 b(\264)-41 b(un)26
b(m)6 b(\264)-39 b(as)120 527 y(la)25 b(implementaci)8
b(\264)-41 b(on.)266 648 y(Las)36 b(implicaciones)f(directas)h(de)g
(este)g(modelo)e(son)i(que)g(la)g(aplicaci)8 b(\264)-41
b(on)35 b(debe)h(mantener)120 768 y(su)30 b(formulario,)f(en)h(v)o(ez)g
(de)g(dele)o(gar)g(absolutamente)e(la)i(autenticaci)8
b(\264)-41 b(on)30 b(en)g(P)-9 b(API.)31 b(Deber)6 b(\264)-39
b(a)30 b(re-)120 888 y(coger)h(los)f(datos)g(del)g(usuario)g(y)g
(realizar)h(los)f(an)6 b(\264)-39 b(alisis)30 b(pertinentes)f(\(como)h
(v)o(eri\002car)h(si)f(se)h(ha)120 1009 y(introducido)25
b(un)i(nombre)g(de)g(usuario)f(o)h(un)g(DNI)g(y)g(si)f(se)i(conecta)f
(desde)g(la)g(red)g(corporati)n(v)n(a\),)120 1129 y(y)36
b(proceder)g(de)g(forma)g(adecuada.)g(En)g(particular)l(,)g(si)f(se)h
(recibe)g(un)g(DNI)g(la)f(aplicaci)8 b(\264)-41 b(on)36
b(de-)120 1249 y(ber)6 b(\264)-39 b(a)25 b(autenticar)g(por)f(su)h
(cuenta)f(contra)h(la)g(base)g(de)f(datos,)g(y)h(si)f(recibe)h(un)g
(nombre)f(de)h(usuario)120 1370 y(deber)6 b(\264)-39
b(a)31 b(dele)o(gar)e(la)i(autenticaci)8 b(\264)-41 b(on)29
b(en)i(un)f Fl(phpP)-8 b(oA)p Fm(.)29 b(Al)h(introducir)f(un)h
Fl(phpP)-8 b(oA)29 b Fm(como)h(forma)120 1490 y(de)d(autenticaci)8
b(\264)-41 b(on)25 b(se)i(elimina)e(la)i(necesidad)f(de)g(acceder)i(e)o
(xclusi)n(v)n(amente)c(desde)i(la)h(red)g(de)f(la)120
1611 y(uni)n(v)o(ersidad,)i(ya)j(que)f(P)-9 b(API)31
b(proporciona)f(las)g(garant)m(\264)-30 b(\021as)29 b(de)h(se)o
(guridad)g(necesarias)g(para)h(que)120 1731 y(los)24
b(usuarios)g(accedan)i(a)f(la)g(aplicaci)8 b(\264)-41
b(on)24 b(desde)h(otras)f(localizaciones.)266 1851 y(La)29
b(implementaci)8 b(\264)-41 b(on)27 b(de)i(este)f(sistema)g(no)g(es)h
(en)g(absoluto)e(tri)n(vial.)g(Una)i(forma)g(m)6 b(\264)-39
b(as)28 b(sen-)120 1972 y(cilla)23 b(de)h(implementar)e(el)i(acceso)g
(autenticado)f(a)h(la)g(aplicaci)8 b(\264)-41 b(on)23
b(a)h(tra)n(v)6 b(\264)-39 b(es)24 b(de)g(P)-9 b(API)24
b(consiste)f(en)120 2092 y(implementar)29 b(un)h(\002chero)h(PHP)g
(aparte,)g(por)f(ejemplo,)g(papi.php,)f(al)i(que)f(se)g(acceder)6
b(\264)-39 b(a)32 b(desde)120 2213 y(la)f(lista)e(de)i(aplicaciones)f
(del)h(servidor)f(de)h(autenticaci)8 b(\264)-41 b(on,)30
b(y)g(que)h(b)6 b(\264)-39 b(asicamente)30 b(realizar)6
b(\264)-39 b(a)31 b(un)120 2333 y(POST)37 b(manual)e(al)h(formulario)f
(de)i(gente.)e(De)i(esta)f(forma)g(podemos)f(acceder)i(una)f(v)o(ez)g
(au-)120 2453 y(tenticados)31 b(en)h(P)-9 b(API,)32 b(pero)g(perdemos)g
(la)g(capacidad)g(de)g(hacerlo)g(directamente,)f(vi)6
b(\264)-39 b(endonos)120 2574 y(obligados)23 b(a)i(hacerlo)g
(obligatoriamente)e(a)i(tra)n(v)6 b(\264)-39 b(es)25
b(del)f Fl(AS)p Fm(.)364 2802 y Fh(<?php)364 2922 y($AS)50
b(=)h("https://www.papi.urjc.es/cgi-bin)o(/Auth)o(Server)o(";)364
3043 y(include'PoA.php';)364 3284 y($poa)f(=)h(new)f(PoA\(')p
Fg(gente)p Fh('\);)364 3404 y(list\($res,)f($userAssertion\))f(=)i
Fg($poa->check)p 2503 3404 30 4 v 34 w(Access\(\))p Fh(;)364
3645 y(//)g(comprobamos)f(si)h(el)h(usuario)e(est)1990
3644 y(\264)1990 3645 y(a)h(autenticado)364 3765 y Fg(if)59
b(\($res)g(==)g(0\))h Fd(f)465 3885 y Fh(//)51 b(el)f(GPoA)g(no)h
(autentica)465 4006 y(header\("Location:)d($AS"\);)465
4126 y(exit;)364 4247 y Fd(g)364 4487 y Fh(//)i(verificamos)f(la)h
(aserci)1584 4486 y(\264)1584 4487 y(on)364 4608 y(if)g
(\(!strpos\($userAssertion,','\)\))c Fd(f)567 4728 y
Fh(header\("Location:)i($AS"\);)567 4848 y(exit;)364
4969 y Fd(g)364 5210 y Fh(//)i(obtenemos)f(las)i(variables)e(de)h(la)h
(aserci)2347 5209 y(\264)2347 5210 y(on)364 5330 y(list\()p
Fg($mail)p Fh(,)p Fg($other)p Fh(\))c(=)j
(split\(",",$userAssertion,2\);)364 5450 y(list\()p Fg($usuario)p
Fh(,)p Fg($server)p Fh(\))c(=)51 b(split\("@",$mail,2\);)p
eop end
%%Page: 26 26
TeXDict begin 26 25 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(26)364 407 y Fh(list\()p Fg($clave)p Fh(,)p Fg($AS)p
Fh(\))47 b(=)k(split\("@",$other,2\);)364 648 y(//)f(rellenamos)f
(manualmente)g(las)h(variables)f(del)h(formulario)364
768 y(@$)p 472 768 30 4 v 35 w(REQUEST['accion'])e(=)j("entrar";)364
888 y Fg(@$)p 490 888 V 35 w(REQUEST['usuario'])56 b(=)k($usuario;)364
1009 y(@$)p 490 1009 V 35 w(REQUEST['clave'])c(=)k($clave;)364
1129 y Fh(@$)p 472 1129 V 35 w(REQUEST['submit'])48 b(=)j("Aceptar";)
364 1370 y(//)f(invocamos)f(manualmente)g(a)i(la)f(autenticaci)2449
1369 y(\264)2449 1370 y(on)364 1490 y Fg(require)58 b(\("login.php"\);)
364 1611 y Fh(?>)120 1906 y Fj(3.6.)119 b(Campus)30 b(V)l(irtual)g(\(W)
-8 b(ebCT\))266 2093 y Fm(El)34 b(caso)g(de)f(W)-8 b(ebCT)35
b(es)e(relati)n(v)n(amente)g(sencillo,)f(ya)i(que)g(basta)f(con)h
(instalar)f(un)h(proxy)120 2214 y(de)d(reescritura)g(que)g(rellene)g
(autom)6 b(\264)-39 b(aticamente)29 b(el)i(formulario)f(de)h
(autenticaci)8 b(\264)-41 b(on.)30 b(Y)-10 b(a)31 b(que)g(la)120
2334 y(aplicaci)8 b(\264)-41 b(on)39 b(se)h(distrib)n(uye)e(con)h(su)g
(propio)g(servidor)g(web)h(y)f(es)h(propietaria,)f(utilizar)g(otros)120
2455 y(m)6 b(\264)-39 b(etodos)29 b(de)h(inte)o(graci)8
b(\264)-41 b(on)29 b(con)h(P)-9 b(API)31 b(se)f(complica)f
(considerablemente.)g(A)h(continuaci)8 b(\264)-41 b(on)29
b(se)120 2575 y(muestra)24 b(una)h(con\002guraci)8 b(\264)-41
b(on)25 b(de)g(ejemplo:)364 2803 y Fh(<VirtualHost)48
b(192.168.84.92:80>)465 2924 y(ServerName)h Fg
(campusvirtual.papi.urjc.es)465 3044 y Fh(RedirectMatch)g(/index.html)g
(https://campusvirtual.papi.urjc.)o(es)465 3164 y(ErrorDocument)g(404)h
Fg(https://campusvirtual.papi.urj)o(c.es)o(/inde)o(x.ht)o(ml)364
3285 y Fh(</VirtualHost>)364 3526 y(<VirtualHost)e(192.168.84.92:443>)
465 3646 y(ServerName)h Fg(campusvirtual.papi.urjc.es)465
3766 y Fh(ErrorDocument)g(403)h(https://www.papi.urjc.es/cgi-bin/Au)o
(thSer)o(ver)465 3887 y(<Location)g(/>)567 4007 y(PerlSendHeader)e(On)
567 4127 y(PerlAccessHandler)g(PAPI::Main)567 4248 y(<PAPI)p
828 4248 V 35 w(Local>)669 4368 y(Service)p 1032 4368
V 34 w(ID)j Fg(campusvirtual)669 4489 y Fh(Req)p 828
4489 V 35 w(DB)f(/usr/local/PAPI/PoA/req)p 2188 4489
V 32 w(campusvirtual)669 4609 y(GPoA)p 879 4609 V 35
w(URL)g(wayf:built-in)669 4729 y Fg(Remote)p 1035 4729
V 34 w(URL)59 b(http://www.campusvirtual.urjc.e)o(s)669
4850 y(Eval)p 915 4850 V 35 w(Proxy)p 1250 4850 V 34
w(Redirects)f(1)714 4970 y(Form)p 960 4970 V 35 w(Processor)f
(urle=>.*/webct/ticket/ticketLog)o(in)p Fd(n)p Fg(?)o
Fd(n)833 5090 y Fg(action=print)p 1559 5090 V 33 w(login&request)p
2372 5090 V 33 w(uri=/webct/homearea/homearea.*)c Fd(n)833
5211 y Fg(form=>authenticate)j(buttonName=>submitbutton)e
Fd(n)833 5331 y Fg(field=>\(Password,$r->notes\('PA)o(PIAt)o(tr-pa)o
(sswo)o(rd'\)\))f Fd(n)833 5452 y Fg(field=>\(WebCT)p
1619 5452 V 33 w(ID,$r->notes\('PAPIAttr-usernam)o(e'\)\))p
eop end
%%Page: 27 27
TeXDict begin 27 26 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(27)567 407 y Fh(</PAPI)p 879 407 30 4 v 35 w(Local>)465
527 y(</Location>)364 648 y(</VirtualHost>)120 943 y
Fj(3.7.)119 b(Secr)n(etar)845 942 y(\264)848 943 y(\021a)30
b(V)l(irtual)266 1130 y Fm(El)g(caso)f(de)h(la)g(secretar)m(\264)-30
b(\021a)30 b(virtual)f(es)g(un)h(poco)f(m)6 b(\264)-39
b(as)29 b(delicado.)g(Su)h(formulario)f(de)h(identi-)120
1251 y(\002caci)8 b(\264)-41 b(on)30 b(utiliza)e(distintos)f(par)6
b(\264)-39 b(ametros)29 b(dependiendo)f(del)h(tipo)g(de)g(usuario.)g
(En)f(caso)i(de)f(que)120 1371 y(el)c(usuario)g(sea)h(P)-9
b(AS)26 b(o)f(PDI)h(utilizar)6 b(\264)-39 b(a)25 b(el)h(nombre)e(de)i
(usuario)f(y)g(contrase)8 b(\230)-41 b(na)26 b(que)f(se)g(utiliza)g(en)
120 1491 y(el)g(resto)g(de)g(servicios,)g(mientras)f(que)h(los)g
(alumnos)f(deber)6 b(\264)-39 b(an)25 b(utilizar)g(su)g(DNI)g(\(sin)g
(letra\))g(y)g(su)120 1612 y(contrase)8 b(\230)-41 b(na.)32
b(Instalaremos)f(un)h(proxy)f(de)h(reescritura)h(con)f(autocompletado)e
(de)i(formulario,)120 1732 y(con)25 b(la)g(particularidad)f(de)h(que)g
(necesitaremos)g(hacer)g(uso)g(de)g(la)g(directi)n(v)n(a)f
Fl(Hcook)p 3097 1732 V 35 w(Gener)o(ator)120 1853 y Fm(para)35
b(modi\002car)g(la)f(aserci)8 b(\264)-41 b(on)35 b(emitida)e(por)h(el)h
(AS)g(atendiendo)f(al)g(tipo)g(de)h(usuario.)e(De)i(este)120
1973 y(modo)26 b(comprobaremos)f(si)h(el)h(usuario)e(tiene)i(per\002l)g
(de)f(alumno,)g(y)g(en)h(tal)f(caso)h(sustituiremos)120
2093 y(su)d(nombre)h(de)g(usuario)f(por)h(su)f(DNI)h(sin)f(letra.)266
2214 y(A)33 b(continuaci)8 b(\264)-41 b(on)32 b(se)g(muestra)h(una)f
(con\002guraci)8 b(\264)-41 b(on)33 b(muy)f(b)6 b(\264)-39
b(asica)33 b(de)g(un)f(proxy)h(P)-9 b(API)33 b(que)120
2334 y(rellenar)6 b(\264)-39 b(a)38 b(el)g(formulario)f
(correspondiente,)g Fb(sin)g Fm(modi\002car)h(la)g(cookie,)f(de)h(modo)
e(que)i(s)8 b(\264)-41 b(olo)120 2455 y(permitir)6 b(\264)-39
b(a)24 b(identi\002carse)h(al)g(personal)f(uni)n(v)o(ersitario:)364
2683 y Fh(<VirtualHost)48 b(192.168.84.92:80>)465 2803
y(ServerName)h Fg(gestion.papi.urjc.es)465 2924 y Fh(RedirectMatch)g
(/index.html)g(https://gestion.papi.urjc.es)465 3044
y(ErrorDocument)g(404)h Fg(https://gestion.papi.urjc.es/i)o(ndex)o
(.html)364 3164 y Fh(</VirtualHost>)364 3405 y(<VirtualHost)e
(192.168.84.92:443>)465 3526 y(ServerName)h Fg(gestion.papi.urjc.es)465
3646 y Fh(ErrorDocument)g(403)h(https://www.papi.urjc.es/cgi-bin/Au)o
(thSer)o(ver)465 3766 y(<Location)g(/>)567 3887 y(PerlSendHeader)e(On)
567 4007 y(PerlAccessHandler)g(PAPI::Main)567 4127 y(<PAPI)p
828 4127 V 35 w(Local>)669 4248 y(Service)p 1032 4248
V 34 w(ID)j Fg(gestion)669 4368 y Fh(Req)p 828 4368 V
35 w(DB)f(/usr/local/PAPI/PoA/req)p 2188 4368 V 32 w(gestion)669
4489 y(GPoA)p 879 4489 V 35 w(URL)g(wayf:built-in)669
4609 y Fg(Remote)p 1035 4609 V 34 w(URL)59 b(https://gestion.urjc.es)
669 4729 y(Redirect)p 1155 4729 V 34 w(All)g(1)669 4850
y(PAPI)p 915 4850 V 35 w(Redirect)f(gestion.urjc.es\(.*?\))d
(gestion.papi.urjc.es$1)714 4970 y(Eval)p 960 4970 V
35 w(Proxy)p 1295 4970 V 34 w(Redirects)j(1)669 5090
y(Form)p 915 5090 V 35 w(Processor)f(urle=>\210/Redcampus/acceso.htm$)d
Fd(n)833 5211 y Fg(form=>formAcceso)i(buttonName=>image)g
Fd(n)833 5331 y Fg(field=>\(TXT)p 1499 5331 V 34 w
(CLAVE,$r->notes\('PAPIAttr-p)o(asswo)o(rd'\))o(\))e
Fd(n)833 5452 y Fg(field=>\(TXT)p 1499 5452 V 34 w
(USUARIO,$r->notes\('PAPIAttr)o(-user)o(name)o('\)\))p
eop end
%%Page: 28 28
TeXDict begin 28 27 bop 120 100 a Fk(3)99 b(INTEGRA)l(CI)825
77 y(\264)801 100 y(ON)26 b(CON)f(APLICA)l(CIONES)1520
b Fm(28)567 407 y Fh(</PAPI)p 879 407 30 4 v 35 w(Local>)465
527 y(</Location>)364 648 y(</VirtualHost>)p eop end
%%Trailer

userdict /end-hook known{end-hook}if
%%EOF
